# Playwrightå…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯å·¥ç¨‹å®è·µæŒ‡å—
## ç›®å½•

- [1. å¼•è¨€ä¸æ ¸å¿ƒä»·å€¼](#1-å¼•è¨€ä¸æ ¸å¿ƒä»·å€¼)
  - [1.1 ä¸ºä»€ä¹ˆè¦åšå…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯ï¼Ÿ](#11-ä¸ºä»€ä¹ˆè¦åšå…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯)
  - [1.2 è§£å†³çš„å·¥ç¨‹ç—›ç‚¹](#12-è§£å†³çš„å·¥ç¨‹ç—›ç‚¹)
  - [1.3 é€‚ç”¨åœºæ™¯ä¸å›¢é˜Ÿæ”¶ç›Š](#13-é€‚ç”¨åœºæ™¯ä¸å›¢é˜Ÿæ”¶ç›Š)
- [2. æ€»è§ˆä¸æ¶æ„å›¾](#2-æ€»è§ˆä¸æ¶æ„å›¾)
  - [2.1 å…¨é“¾è·¯é—­ç¯å…¨æ™¯](#21-å…¨é“¾è·¯é—­ç¯å…¨æ™¯)
  - [2.2 æ¶æ„æµç¨‹å›¾](#22-æ¶æ„æµç¨‹å›¾)
  - [2.3 å„èŠ‚ç‚¹å·¥ç¨‹è§’è‰²ä¸æ•°æ®æµ](#23-å„èŠ‚ç‚¹å·¥ç¨‹è§’è‰²ä¸æ•°æ®æµ)
- [3. èŠ‚ç‚¹å®æˆ˜è¯¦è§£](#3-èŠ‚ç‚¹å®æˆ˜è¯¦è§£)
  - [3.1 æµ‹è¯•è„šæœ¬å”¯ä¸€æ€§ä¸ç¨³å®šæ€§](#31-æµ‹è¯•è„šæœ¬å”¯ä¸€æ€§ä¸ç¨³å®šæ€§)
  - [3.2 æ€§èƒ½æ•°æ®åˆ†é¡¹é‡‡é›†ä¸å½’æ¡£](#32-æ€§èƒ½æ•°æ®åˆ†é¡¹é‡‡é›†ä¸å½’æ¡£)
    - [3.2.1 Playwright attach æ•°æ®ç»“æ„ä¸å½’æ¡£è„šæœ¬ä¸€è‡´æ€§](#321-playwright-attach-æ•°æ®ç»“æ„ä¸å½’æ¡£è„šæœ¬ä¸€è‡´æ€§)
  - [3.3 API èšåˆä¸å‰ç«¯å¯è§†åŒ–](#33-api-èšåˆä¸å‰ç«¯å¯è§†åŒ–)
    - [3.3.1 ä»ªè¡¨ç›˜é¡µé¢åˆ†ç¦»ä¸å®Œæ•´æ¨¡æ¿](#331-ä»ªè¡¨ç›˜é¡µé¢åˆ†ç¦»ä¸å®Œæ•´æ¨¡æ¿)
  - [3.4 æŠ¥å‘Šä¸ç´¢å¼•è‡ªåŠ¨åŒ–](#34-æŠ¥å‘Šä¸ç´¢å¼•è‡ªåŠ¨åŒ–)
- [4. å®‰å…¨ä¸å·¥ç¨‹è§„èŒƒ](#4-å®‰å…¨ä¸å·¥ç¨‹è§„èŒƒ)
  - [4.1 æµ‹è¯•APIå®‰å…¨æš´éœ²åŸåˆ™](#41-æµ‹è¯•apiå®‰å…¨æš´éœ²åŸåˆ™)
  - [4.2 æµ‹è¯•æ•°æ®ä¸æŠ¥å‘Šéš”ç¦»ä¸åŒæ­¥è§„èŒƒ](#42-æµ‹è¯•æ•°æ®ä¸æŠ¥å‘Šéš”ç¦»ä¸åŒæ­¥è§„èŒƒ)
  - [4.3 ä¾èµ–ä¸ç‰ˆæœ¬å®‰å…¨ã€æƒé™è¾¹ç•Œ](#43-ä¾èµ–ä¸ç‰ˆæœ¬å®‰å…¨æƒé™è¾¹ç•Œ)
- [5. ç¯å¢ƒä¸ç›®å½•é…ç½®](#5-ç¯å¢ƒä¸ç›®å½•é…ç½®)
  - [5.1 Next.js 13+ App Router ç»“æ„ä¸é¡µé¢è§„èŒƒ](#51-nextjs-13-app-router-ç»“æ„ä¸é¡µé¢è§„èŒƒ)
  - [5.2 ç›®å½•ç»“æ„æ ‘ä¸å·¥ç¨‹åˆ†å±‚](#52-ç›®å½•ç»“æ„æ ‘ä¸å·¥ç¨‹åˆ†å±‚)
  - [5.3 .gitignore/.gitkeep é…ç½®è¦ç‚¹](#53-gitignoregitkeep-é…ç½®è¦ç‚¹)
  - [5.4 Playwright é…ç½®ä¸ç¯å¢ƒåˆ†ç»„](#54-playwright-é…ç½®ä¸ç¯å¢ƒåˆ†ç»„)
    - [5.4.1 Playwright å®‰è£…ä¸åˆå§‹åŒ–](#541-playwright-å®‰è£…ä¸åˆå§‹åŒ–)
    - [5.4.2 ç‰ˆæœ¬ç®¡ç†ä¸å®šæœŸå‡çº§](#542-ç‰ˆæœ¬ç®¡ç†ä¸å®šæœŸå‡çº§)
    - [5.4.3 å…³é”®é…ç½®ä¸å¤šç«¯ï¼ˆMCPï¼‰ç¤ºä¾‹](#543-å…³é”®é…ç½®ä¸å¤šç«¯mcpç¤ºä¾‹)
    - [5.4.4 æŒ‡ä»¤ä¸æµç¨‹è§„èŒƒ](#544-æŒ‡ä»¤ä¸æµç¨‹è§„èŒƒ)
    - [5.4.5 æµ‹è¯•ç»“æœä¸æŠ¥å‘Šç›®å½•](#545-æµ‹è¯•ç»“æœä¸æŠ¥å‘Šç›®å½•)
    - [5.4.6 ç»´æŠ¤ä¸å·¥ç¨‹å»ºè®®](#546-ç»´æŠ¤ä¸å·¥ç¨‹å»ºè®®)
- [6. åœºæ™¯ä¸æµç¨‹å®å½•](#6-åœºæ™¯ä¸æµç¨‹å®å½•)
  - [6.1 å…¸å‹æµ‹è¯•åœºæ™¯å…¨æµç¨‹æ¼”ç¤º](#61-å…¸å‹æµ‹è¯•åœºæ™¯å…¨æµç¨‹æ¼”ç¤º)
    - [6.1.1 å¼€å‘æµ‹è¯•å·¥ä½œæµï¼ˆDevï¼‰](#611-å¼€å‘æµ‹è¯•å·¥ä½œæµdev)
    - [6.1.2 ç”Ÿäº§æµ‹è¯•å·¥ä½œæµï¼ˆProdï¼‰](#612-ç”Ÿäº§æµ‹è¯•å·¥ä½œæµprod)
  - [6.2 å›¢é˜Ÿåä½œä¸‹çš„æµç¨‹åˆ†å·¥](#62-å›¢é˜Ÿåä½œä¸‹çš„æµç¨‹åˆ†å·¥)
  - [6.3 å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•ä¸æ•°æ®å·®å¼‚è¯´æ˜](#63-å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•ä¸æ•°æ®å·®å¼‚è¯´æ˜)
- [7. å¸¸è§é—®é¢˜ä¸æ’æŸ¥](#7-å¸¸è§é—®é¢˜ä¸æ’æŸ¥)
  - [7.1 æµ‹è¯•æµç¨‹å‡å¤±è´¥ä¸UIç«æ€](#71-æµ‹è¯•æµç¨‹å‡å¤±è´¥ä¸uiç«æ€)
  - [7.2 ç¯å¢ƒè¯†åˆ«ä¸æ•°æ®åˆ†ç»„å¼‚å¸¸](#72-ç¯å¢ƒè¯†åˆ«ä¸æ•°æ®åˆ†ç»„å¼‚å¸¸)
  - [7.3 testAPIå®‰å…¨æš´éœ²ä¸æƒé™é—®é¢˜](#73-testapiå®‰å…¨æš´éœ²ä¸æƒé™é—®é¢˜)
  - [7.4 æ€§èƒ½æ•°æ®é‡‡é›†ä¸æŠ¥å‘Šå½’æ¡£å¤±è´¥](#74-æ€§èƒ½æ•°æ®é‡‡é›†ä¸æŠ¥å‘Šå½’æ¡£å¤±è´¥)
  - [7.5 ä¾èµ–ä¸ç¯å¢ƒä¸ä¸€è‡´](#75-ä¾èµ–ä¸ç¯å¢ƒä¸ä¸€è‡´)
  - [7.6 ç›®å½•ç»“æ„ä¸.gitignoreé…ç½®é—®é¢˜](#76-ç›®å½•ç»“æ„ä¸gitignoreé…ç½®é—®é¢˜)
  - [7.7 å‰ç«¯å¯è§†åŒ–ä¸APIèšåˆå¼‚å¸¸](#77-å‰ç«¯å¯è§†åŒ–ä¸apièšåˆå¼‚å¸¸)
  - [7.8 å…¶ä»–å¸¸è§é—®é¢˜](#78-å…¶ä»–å¸¸è§é—®é¢˜)
  - [7.9 é—®é¢˜æ’æŸ¥æµç¨‹å›¾](#79-é—®é¢˜æ’æŸ¥æµç¨‹å›¾)
  - [7.10 æµ‹è¯•è„šæœ¬å˜æ›´åå‰ç«¯æŠ¥å‘Šæ— å˜åŒ–æ˜¯å¦éœ€é‡å¯æœåŠ¡ï¼Ÿ](#710-æµ‹è¯•è„šæœ¬å˜æ›´åå‰ç«¯æŠ¥å‘Šæ— å˜åŒ–æ˜¯å¦éœ€é‡å¯æœåŠ¡)
  - [7.11 å…¸å‹é—®é¢˜ä¸æ’æŸ¥è¡¥å……](#711-å…¸å‹é—®é¢˜ä¸æ’æŸ¥è¡¥å……)
- [8. æ–°é¡¹ç›®è½åœ°æŒ‡å¼•](#8-æ–°é¡¹ç›®è½åœ°æŒ‡å¼•)
  - [8.1 è¿ç§»æ­¥éª¤ä¸æ³¨æ„äº‹é¡¹](#81-è¿ç§»æ­¥éª¤ä¸æ³¨æ„äº‹é¡¹)
    - [8.1.1 ä¸€é”®æ„å»º-åˆå§‹åŒ–æµç¨‹](#811-ä¸€é”®æ„å»º-åˆå§‹åŒ–æµç¨‹)
    - [8.1.2 ä¸€é”®æ‹‰èµ·å…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¸å¯è§†åŒ–æµç¨‹ bootstrap è„šæœ¬](#812-ä¸€é”®æ‹‰èµ·å…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¸å¯è§†åŒ–æµç¨‹-bootstrap-è„šæœ¬)
  - [8.2 ç›®å½•/å­—æ®µ/æµç¨‹/æŠ¥å‘Šä¸€è‡´æ€§è¿ç§»æ¸…å•](#82-ç›®å½•å­—æ®µæµç¨‹æŠ¥å‘Šä¸€è‡´æ€§è¿ç§»æ¸…å•)
  - [8.3 æ¨¡æ¿ä¸è„šæœ¬å¤ç”¨å»ºè®®](#83-æ¨¡æ¿ä¸è„šæœ¬å¤ç”¨å»ºè®®)
  - [8.4 è¿ç§»æ¡ˆä¾‹ä¸è„šæœ¬æ¨¡æ¿](#84-è¿ç§»æ¡ˆä¾‹ä¸è„šæœ¬æ¨¡æ¿)
    - [8.4.1 å…¸å‹è¿ç§»æ¡ˆä¾‹ï¼šPuzzleX æ–°é¡¹ç›®è½åœ°æµç¨‹](#841-å…¸å‹è¿ç§»æ¡ˆä¾‹puzzlex-æ–°é¡¹ç›®è½åœ°æµç¨‹)
    - [8.4.2 ä¸»æµç¨‹ E2E è„šæœ¬æ¨¡æ¿ï¼ˆe2e/full_game_flow.spec.tsï¼‰](#842-ä¸»æµç¨‹-e2e-è„šæœ¬æ¨¡æ¿e2efull_game_flowspects)
    - [8.4.3 å½’æ¡£è„šæœ¬æ¨¡æ¿ï¼ˆscripts/archive-test-results.jsï¼‰](#843-å½’æ¡£è„šæœ¬æ¨¡æ¿scriptsarchive-test-resultsjs)
    - [8.4.4 API èšåˆæ¨¡æ¿ï¼ˆapp/api/performance-trend/route.tsï¼‰](#844-api-èšåˆæ¨¡æ¿appapiperformance-trendroutets)
    - [8.4.5 å‰ç«¯ä»ªè¡¨ç›˜æ¨¡æ¿ç‰‡æ®µï¼ˆapp/test/page.tsxï¼‰](#845-å‰ç«¯ä»ªè¡¨ç›˜æ¨¡æ¿ç‰‡æ®µapptestpagetsx)
    - [8.4.6 å½’æ¡£è„šæœ¬ä¸ API èšåˆå¥å£®æ¨¡æ¿](#846-å½’æ¡£è„šæœ¬ä¸-api-èšåˆå¥å£®æ¨¡æ¿)
- [9. è¿›é˜¶å»ºè®®ä¸å›¢é˜Ÿåä½œ](#9-è¿›é˜¶å»ºè®®ä¸å›¢é˜Ÿåä½œ)
  - [9.1 æŒç»­ä¼˜åŒ–æŒ‡æ ‡é‡‡é›†ä¸è¶‹åŠ¿åˆ†æ](#91-æŒç»­ä¼˜åŒ–æŒ‡æ ‡é‡‡é›†ä¸è¶‹åŠ¿åˆ†æ)
  - [9.2 å›¢é˜Ÿåä½œä¸ CI/CD é›†æˆ](#92-å›¢é˜Ÿåä½œä¸-cicd-é›†æˆ)
  - [9.3 Playwright è„šæœ¬ä¸ä¾èµ–ç»´æŠ¤](#93-playwright-è„šæœ¬ä¸ä¾èµ–ç»´æŠ¤)
  - [9.4 ç»éªŒæ²‰æ·€ä¸æ–‡æ¡£åŒæ­¥æœºåˆ¶](#94-ç»éªŒæ²‰æ·€ä¸æ–‡æ¡£åŒæ­¥æœºåˆ¶)
  - [9.5 å…¸å‹ GitHub Actions CI/CD é…ç½®ç‰‡æ®µï¼ˆplaywright.ymlï¼‰](#95-å…¸å‹-github-actions-cicd-é…ç½®ç‰‡æ®µplaywrightyml)

---

## 1. å¼•è¨€ä¸æ ¸å¿ƒä»·å€¼

### 1.1 ä¸ºä»€ä¹ˆè¦åšå…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯ï¼Ÿ
- ä¼ ç»ŸE2Eæµ‹è¯•æ˜“å—UIå˜åŒ–ã€å¼‚æ­¥æ¸²æŸ“ã€åŠ¨ç”»å»¶è¿Ÿç­‰å½±å“ï¼Œé¢‘ç¹å‡ºç°"å‡å¤±è´¥"ï¼Œå›¢é˜Ÿä¿¡ä»»åº¦ä½ã€‚
- æ€§èƒ½æ•°æ®åˆ†æ•£ã€å­¤ç«‹ï¼Œéš¾ä»¥å½¢æˆè¶‹åŠ¿æ´å¯Ÿï¼Œæ— æ³•æ”¯æ’‘æ€§èƒ½ä¼˜åŒ–å†³ç­–ã€‚
- æµ‹è¯•ã€æŠ¥å‘Šã€å‰ç«¯ã€åä½œæµç¨‹å‰²è£‚ï¼Œè¿ç§»å’Œå›¢é˜Ÿåä½œæˆæœ¬é«˜ã€‚

### 1.2 è§£å†³çš„å·¥ç¨‹ç—›ç‚¹
- æµç¨‹å”¯ä¸€æ–­è¨€ï¼šæ‰€æœ‰æµç¨‹èŠ‚ç‚¹ä»¥"æç¤ºåŒºåŸŸå”¯ä¸€å†…å®¹"ä¸ºæ–­è¨€æ ‡å‡†ï¼Œå½»åº•æ¶ˆé™¤UIç«æ€å’Œå‡å¤±è´¥ã€‚
- æ€§èƒ½åˆ†é¡¹é‡‡é›†ä¸è¶‹åŠ¿åˆ†æï¼šèµ„æºåŠ è½½ã€ç«¯åˆ°ç«¯åŠ è½½ã€FPSã€å†…å­˜ç­‰å¤šé¡¹æŒ‡æ ‡åˆ†é¡¹é‡‡é›†ï¼Œè‡ªåŠ¨å½’æ¡£ã€èšåˆã€è¶‹åŠ¿åˆ†æã€‚
- ç¯å¢ƒåˆ†ç»„ä¸å¯¹æ¯”ï¼šå¼€å‘/ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨è¯†åˆ«ï¼ŒæŠ¥å‘Šã€APIã€å‰ç«¯å…¨é“¾è·¯åˆ†ç»„ã€åˆ‡æ¢ã€å¯¹æ¯”ã€å·®å¼‚é«˜äº®ã€‚
- ä¸€é”®å½’æ¡£ä¸æŠ¥å‘Šè‡ªåŠ¨åŒ–ï¼šæµ‹è¯•å®Œæˆåè‡ªåŠ¨ç”ŸæˆMarkdownæŠ¥å‘Šå’Œç´¢å¼•ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚
- å‰ç«¯ä»ªè¡¨ç›˜å¯è§†åŒ–ï¼šè¶‹åŠ¿å›¾ã€åˆ†ç»„ç»Ÿè®¡ã€å·®å¼‚åˆ†æã€æ€§èƒ½å»ºè®®ä¸€ä½“åŒ–ï¼Œæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€å‡å€¼å¯¹æ¯”ã€‚
- ç›®å½•ä¸åŒæ­¥è§„èŒƒï¼š.gitkeep/.gitignoreè§„èŒƒï¼Œä¸»æµç¨‹/ä¸´æ—¶æµ‹è¯•éš”ç¦»ï¼Œé€‚åˆå›¢é˜Ÿå’ŒCI/CDã€‚
- å¯è¿ç§»æ€§å¼ºï¼šæ‰€æœ‰æ–¹æ¡ˆã€ä»£ç ã€é…ç½®ã€æµç¨‹å‡å¯å¤ç”¨ï¼Œé€‚é…ä¸»æµWebæŠ€æœ¯æ ˆã€‚

### 1.3 é€‚ç”¨åœºæ™¯ä¸å›¢é˜Ÿæ”¶ç›Š
- é€‚ç”¨äºä»»ä½•éœ€è¦é«˜å¯é æ€§E2Eæµ‹è¯•ã€æ€§èƒ½è¶‹åŠ¿åˆ†æã€å›¢é˜Ÿåä½œçš„ç°ä»£Webé¡¹ç›®ã€‚
- å›¢é˜Ÿå¯è·å¾—ï¼šæµ‹è¯•ç¨³å®šæ€§æå‡ã€æ€§èƒ½å¯è§†åŒ–ã€åä½œä¸è¿ç§»é›¶éšœç¢ã€å·¥ç¨‹è§„èŒƒç»Ÿä¸€ã€‚

---

## 2. æ€»è§ˆä¸æ¶æ„å›¾

### 2.1 å…¨é“¾è·¯é—­ç¯å…¨æ™¯

æœ¬é¡¹ç›®å®ç°äº†"æµ‹è¯•-API-å½’æ¡£-èšåˆ-å‰ç«¯å¯è§†åŒ–"å…¨é“¾è·¯è‡ªåŠ¨åŒ–é—­ç¯ï¼Œæ‰€æœ‰æ•°æ®æµã€èŠ‚ç‚¹ã€æŠ¥å‘Šã€å‰ç«¯é¡µé¢å‡å·¥ç¨‹åŒ–æ‰“é€šï¼Œæ”¯æŒå›¢é˜Ÿåä½œä¸æŒç»­é›†æˆã€‚

### 2.2 æ¶æ„æµç¨‹å›¾

```mermaid
graph TD
    Dev["å¼€å‘è€…/CI è¿è¡Œæµ‹è¯• (npm run test:e2e)"] --> E2E["Playwright E2Eæµ‹è¯• (æµç¨‹å”¯ä¸€æç¤º)"]
    E2E --> API["ä¸“ç”¨æµ‹è¯•API (window.testAPI)"]
    E2E --> Archive["è‡ªåŠ¨å½’æ¡£è„šæœ¬ (scripts/archive-test-results.js)"]
    API --> E2E
    Archive --> MD["MarkdownæŠ¥å‘Š (playwright-test-logs/*.md)"]
    FE["å‰ç«¯å¯è§†åŒ–ä»ªè¡¨ç›˜ (app/test/page.tsx)"] --> TrendAPI["å®æ—¶æ•°æ®API (app/api/performance-trend/route.ts)"]
    TrendAPI --> MD

    subgraph "æµ‹è¯•ç¯å¢ƒ (CLI)"
        Dev
        E2E
        Archive
    end
    subgraph "åº”ç”¨æœ¬èº« (æµè§ˆå™¨)"
        API
        FE
    end
    subgraph "æ•°æ®ä¸æœåŠ¡ (æ–‡ä»¶ç³»ç»Ÿ/Next.js)"
        MD
        TrendAPI
    end
```

### 2.3 å„èŠ‚ç‚¹å·¥ç¨‹è§’è‰²ä¸æ•°æ®æµ

- **Dev/CI**ï¼šå¼€å‘è€…æˆ–CIè¿è¡Œ `npm run test:e2e`ï¼Œè§¦å‘å…¨æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚
- **Playwright E2Eæµ‹è¯•**ï¼š`e2e/full_game_flow.spec.ts`ï¼Œä»¥æç¤ºåŒºåŸŸå”¯ä¸€å†…å®¹ä¸ºæ–­è¨€æ ‡å‡†ï¼Œæµç¨‹ç¨³å®šã€‚
- **ä¸“ç”¨æµ‹è¯•API**ï¼š`window.testAPI` æŒ‚è½½äº `GameContext`ï¼ŒPlaywright é€šè¿‡ `page.evaluate` ç›´æ¥é©±åŠ¨æ ¸å¿ƒçŠ¶æ€ï¼Œæ¶ˆé™¤UIç«æ€ã€‚
- **è‡ªåŠ¨å½’æ¡£è„šæœ¬**ï¼š`scripts/archive-test-results.js`ï¼Œè§£æ Playwright æµ‹è¯•ç»“æœï¼Œè‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ– Markdown æŠ¥å‘Šå’Œç´¢å¼•ã€‚
- **MarkdownæŠ¥å‘Š**ï¼š`playwright-test-logs/*.md`ï¼Œæ¯æ¬¡æµ‹è¯•è‡ªåŠ¨å½’æ¡£ï¼Œç»“æ„æ ‡å‡†åŒ–ï¼Œä¾¿äºèšåˆä¸æŸ¥é˜…ã€‚
- **å®æ—¶æ•°æ®API**ï¼š`app/api/performance-trend/route.ts`ï¼ŒåŠ¨æ€èšåˆæ‰€æœ‰æŠ¥å‘Šï¼Œä¾›å‰ç«¯ä»ªè¡¨ç›˜æ‹‰å–ã€‚
- **å‰ç«¯å¯è§†åŒ–ä»ªè¡¨ç›˜**ï¼š`app/test/page.tsx`ï¼Œæ‹‰å–APIæ•°æ®ï¼Œæ”¯æŒåˆ†ç»„ã€å¯¹æ¯”ã€è¶‹åŠ¿ã€å·®å¼‚é«˜äº®ã€æ€§èƒ½å»ºè®®ç­‰ã€‚

> å·¥ç¨‹è½åœ°è¦ç‚¹ï¼šæ‰€æœ‰èŠ‚ç‚¹å‡æœ‰çœŸå®ä»£ç å®ç°ï¼Œæ•°æ®ç»“æ„ã€å­—æ®µã€æµç¨‹å…¨é“¾è·¯ä¸€è‡´ï¼Œä¾¿äºè¿ç§»å’Œå›¢é˜Ÿåä½œã€‚

---

## 3. èŠ‚ç‚¹å®æˆ˜è¯¦è§£

### 3.1 æµ‹è¯•è„šæœ¬å”¯ä¸€æ€§ä¸ç¨³å®šæ€§

- **è®¾è®¡åŸåˆ™**ï¼šæ‰€æœ‰æµç¨‹èŠ‚ç‚¹ã€æ–­è¨€ã€æ€§èƒ½é‡‡é›†å‡ä»¥æç¤ºåŒºåŸŸå”¯ä¸€å†…å®¹ä¸ºæ ‡å‡†ï¼Œæœç»UIç«æ€ã€‚
- **ä¸“ç”¨æµ‹è¯•API**ï¼š`window.testAPI` æŒ‚è½½äº GameContextï¼Œä»…åœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒæš´éœ²ï¼ŒPlaywright é€šè¿‡ `page.evaluate` ç›´æ¥é©±åŠ¨æ ¸å¿ƒçŠ¶æ€ã€‚
- **çœŸå®ä»£ç ç‰‡æ®µ**ï¼š
```tsx
  // contexts/GameContext.tsx
  useEffect(() => {
    if (process.env.NODE_ENV !== 'production') {
      window.testAPI = {
        selectPieceForTest: (id) => dispatch({ type: 'SELECT_PIECE', payload: id }),
        rotatePieceForTest: () => dispatch({ type: 'ROTATE_PIECE' }),
        resetPiecePositionForTest: (id) => dispatch({ type: 'RESET_PIECE_POSITION', payload: id }),
        markPieceAsCompletedForTest: (id) => dispatch({ type: 'MARK_PIECE_COMPLETED', payload: id }),
      };
    }
  }, [dispatch]);
  ```
  ```js
  // e2e/full_game_flow.spec.ts
  await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©ä¸€ä¸ªå½¢çŠ¶');
  await page.evaluate(() => window.testAPI.selectPieceForTest(1));
  await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©åˆ‡å‰²ç±»å‹');
// ...
  await expect(page.locator('#flow-tip')).toHaveText('æ‹¼å›¾å®Œæˆï¼');
  ```
- **å·¥ç¨‹æ•ˆæœ**ï¼šæµç¨‹å”¯ä¸€æ–­è¨€ï¼Œæµ‹è¯•100%ç¨³å®šï¼Œå½»åº•æ¶ˆé™¤UIç«æ€å’Œå‡å¤±è´¥ã€‚

---

### 3.2 æ€§èƒ½æ•°æ®åˆ†é¡¹é‡‡é›†ä¸å½’æ¡£

- **é‡‡é›†æŒ‡æ ‡**ï¼šèµ„æºåŠ è½½ã€ç«¯åˆ°ç«¯åŠ è½½ã€å½¢çŠ¶ç”Ÿæˆã€æ‹¼å›¾ç”Ÿæˆã€æ•£å¼€ã€äº¤äº’ã€FPSã€å†…å­˜ç­‰ã€‚
- **é‡‡é›†æ–¹å¼**ï¼šPlaywright è„šæœ¬å†…é€šè¿‡ `page.evaluate` é‡‡é›†å¹¶é™„åŠ åˆ°æµ‹è¯•æŠ¥å‘Šã€‚
- **çœŸå®ä»£ç ç‰‡æ®µ**ï¼š
  ```js
  // e2e/full_game_flow.spec.ts
  const pageLoad = await page.evaluate(() => window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart);
  const e2eLoad = ... // é€šè¿‡æµç¨‹å”¯ä¸€æç¤ºåŒºåŸŸé‡‡é›†
  const fps = await page.evaluate(() => window.__gameStateForTests__.fps);
  await testInfo.attach('performance-metrics', { body: Buffer.from(JSON.stringify({ pageLoad, e2eLoad, fps }), 'utf-8'), contentType: 'application/json' });
  ```
- **å½’æ¡£è„šæœ¬**ï¼š
  ```js
  // scripts/archive-test-results.js
  // è§£æ test-results.jsonï¼Œæå– performance-metrics é™„ä»¶ï¼Œç”Ÿæˆ Markdown æŠ¥å‘Š
  const decodedBody = Buffer.from(performanceAttachment.body, 'base64').toString('utf8');
  metrics = JSON.parse(decodedBody);
  // ...
  await fse.writeFile(reportFilePath, reportContent.trim());
  ```
- **æŠ¥å‘Šç¤ºä¾‹**ï¼ˆè§ test-report-*.mdï¼‰ï¼š
  ```markdown
  <!-- { "env": "production", "metrics": { "pageLoad": 950, ... } } -->
  # å®Œæ•´è‡ªåŠ¨åŒ–æ¸¸æˆæµç¨‹ - æµ‹è¯•æŠ¥å‘Š
  - **æµ‹è¯•æ—¥æœŸ**: 2025-07-06 00:55:12
  - **æµ‹è¯•ç»“æœ**: å®Œæ•´è‡ªåŠ¨åŒ–æ¸¸æˆæµç¨‹ (é€šè¿‡)
  ## æä¼˜æ€§èƒ½é«˜äº®
  - ğŸš€ èµ„æºåŠ è½½æ—¶é—´æä¼˜: 14ms
  ...
  ## æ€§èƒ½è¯„æµ‹æŒ‡æ ‡
  | æŒ‡æ ‡ (å•ä½) | ç»“æœ | åŸºå‡†å€¼ | çŠ¶æ€ |
  | ----------- | ---- | ------ | ---- |
  | èµ„æºåŠ è½½æ—¶é—´ (ms) | 14ms | < 1000ms | âœ… |
  ...
  ```
- **å·¥ç¨‹æ•ˆæœ**ï¼šæ‰€æœ‰æ€§èƒ½æ•°æ®è‡ªåŠ¨å½’æ¡£ã€åˆ†é¡¹å±•ç¤ºã€è¶‹åŠ¿åˆ†æï¼Œä¾¿äºæ€§èƒ½ä¼˜åŒ–ã€‚

#### 3.2.1 Playwright attach æ•°æ®ç»“æ„ä¸å½’æ¡£è„šæœ¬ä¸€è‡´æ€§

> **å·¥ç¨‹è¦ç‚¹ï¼šPlaywright attach çš„æ€§èƒ½æ•°æ®ç»“æ„ä¸å½’æ¡£è„šæœ¬çš„éå†/è§£ææ–¹å¼å¿…é¡»100%ä¸€è‡´ï¼Œå¦åˆ™æŠ¥å‘Šå½’æ¡£å’Œå‰ç«¯èšåˆä¼šå‡ºç°æ•°æ®ç¼ºå¤±ã€‚**

- Playwright attach æ€§èƒ½æ•°æ®æ¨èå†™æ³•ï¼š
```js
// e2e/full_game_flow.spec.ts
await test.info().attach('performance-metrics', {
  body: Buffer.from(JSON.stringify({ pageLoad, e2eLoad, fps }), 'utf-8'),
  contentType: 'application/json'
});
```
- å½’æ¡£è„šæœ¬éå†æ–¹å¼éœ€ä¸¥æ ¼åŒ¹é… Playwright test-results.json ç»“æ„ï¼š
```js
// scripts/archive-test-results.js
const results = JSON.parse(fs.readFileSync('test-results/test-results.json', 'utf-8'));
results.suites.forEach(suite => {
  suite.specs.forEach(spec => {
    spec.tests.forEach(test => {
      test.results.forEach(result => {
        (result.attachments || []).forEach(attachment => {
          if (attachment.name === 'performance-metrics') {
            // è§£ææ€§èƒ½æ•°æ®
            const metrics = JSON.parse(Buffer.from(attachment.body, 'base64').toString('utf-8'));
            // ...
          }
        });
      });
    });
  });
});
```
- **æ³¨æ„äº‹é¡¹**ï¼š
  - Playwright ç‰ˆæœ¬å‡çº§åï¼Œtest-results.json ç»“æ„å¯èƒ½æœ‰ç»†å¾®å˜åŒ–ï¼Œå½’æ¡£è„šæœ¬éœ€åŒæ­¥é€‚é…ã€‚
  - å»ºè®®åœ¨å½’æ¡£è„šæœ¬é¡¶éƒ¨æ³¨é‡Šè¯´æ˜ Playwright JSON ç»“æ„ï¼Œä¾¿äºå›¢é˜Ÿç»´æŠ¤ã€‚
  - å¦‚éœ€é‡‡é›†å¤šç§æŒ‡æ ‡ï¼Œå¯ç”¨ä¸åŒ attachment nameï¼Œå½’æ¡£è„šæœ¬éœ€å…¨éƒ¨éå†å¹¶èšåˆã€‚

> **å»ºè®®**ï¼šè¿ç§»/æ–°é¡¹ç›®è½åœ°æ—¶ï¼Œå…ˆç”¨çœŸå®æµ‹è¯•æ•°æ®è·‘ä¸€éï¼Œç¡®è®¤ attach ç»“æ„ä¸å½’æ¡£è„šæœ¬å®Œå…¨ä¸€è‡´ï¼Œå†æ‰¹é‡è¿ç§»å’Œå›¢é˜Ÿæ¨å¹¿ã€‚

---

### 3.3 API èšåˆä¸å‰ç«¯å¯è§†åŒ–

- **APIèšåˆ**ï¼šNext.js API åŠ¨æ€èšåˆæ‰€æœ‰æŠ¥å‘Šï¼Œå‰ç«¯å®æ—¶æ‹‰å–ã€‚
- **çœŸå®ä»£ç ç‰‡æ®µ**ï¼š
  ```ts
  // app/api/performance-trend/route.ts
    import fs from 'fs';
    import path from 'path';
    export async function GET() {
        const logDir = path.join(process.cwd(), 'playwright-test-logs');
        const files = fs.readdirSync(logDir).filter(f => f.endsWith('.md'));
        const trendData = files.map(file => {
            const content = fs.readFileSync(path.join(logDir, file), 'utf-8');
            const match = content.match(/<!--\s*(\{[\s\S]*?\})\s*-->/);
            if (match && match[1]) {
                return JSON.parse(match[1]).data;
            }
            return null;
        }).filter(Boolean);
        return new Response(JSON.stringify(trendData.reverse()));
    }
    ```
  ```tsx
  // app/test/page.tsx
  useEffect(() => {
    async function fetchData() {
      const res = await fetch('/api/performance-trend');
      const data = await res.json();
      setTrendData(data);
    }
    fetchData();
  }, []);
  // ...
  <LineChart data={trendData} ... />
  <Table data={trendData} ... />
  ```
- **å·¥ç¨‹æ•ˆæœ**ï¼šå‰ç«¯ä»ªè¡¨ç›˜æ”¯æŒåˆ†ç»„ã€å¯¹æ¯”ã€è¶‹åŠ¿ã€å·®å¼‚é«˜äº®ã€æ€§èƒ½å»ºè®®ï¼Œå›¢é˜Ÿå¯ä¸€ç«™å¼æŸ¥é˜…ã€‚

#### 3.3.1 ä»ªè¡¨ç›˜é¡µé¢åˆ†ç¦»ä¸å®Œæ•´æ¨¡æ¿

> **å·¥ç¨‹è¦ç‚¹ï¼šä»ªè¡¨ç›˜é¡µé¢å»ºè®®ä¸ä¸»äº¤äº’é¡µé¢å½»åº•åˆ†ç¦»ï¼Œå•ç‹¬æ”¾ç½®äº `app/test/dashboard/page.tsx`ï¼Œé¿å…ä¸ä¸»æµç¨‹é¡µé¢æ··æ·†ï¼Œä¾¿äºç»´æŠ¤å’Œå›¢é˜Ÿåä½œã€‚**

- æ¨èç›®å½•ç»“æ„ï¼š
```
app/
  page.tsx                  # ä¸»äº¤äº’é¡µé¢
  test/
    dashboard/
      page.tsx              # ä»ªè¡¨ç›˜é¡µé¢ï¼ˆåˆ†ç¦»ï¼‰
```
- ä»ªè¡¨ç›˜é¡µé¢å®Œæ•´æ¨¡æ¿ï¼š
```tsx
// app/test/dashboard/page.tsx
import { useEffect, useState } from 'react';

export default function Dashboard() {
  const [trendData, setTrendData] = useState([]);
  useEffect(() => {
    fetch('/api/performance-trend')
      .then(res => res.json())
      .then(setTrendData);
  }, []);
  return (
    <div>
      <h2>è‡ªåŠ¨åŒ–æµ‹è¯•è¶‹åŠ¿ä»ªè¡¨ç›˜</h2>
      <table>
        <thead>
          <tr>
            <th>æ—¶é—´</th>
            <th>ç¯å¢ƒ</th>
            <th>èµ„æºåŠ è½½(ms)</th>
            <th>ç«¯åˆ°ç«¯åŠ è½½(ms)</th>
            {/* å¯æ‰©å±•æ›´å¤šæŒ‡æ ‡ */}
          </tr>
        </thead>
        <tbody>
          {trendData.map((item, idx) => (
            <tr key={idx}>
              <td>{item.metrics?.date || '-'}</td>
              <td>{item.env || '-'}</td>
              <td>{item.metrics?.pageLoad || '-'}</td>
              <td>{item.metrics?.e2eLoad || '-'}</td>
            </tr>
          ))}
        </tbody>
      </table>
      {/* å¯æ‰©å±•ä¸ºè¶‹åŠ¿å›¾ã€åˆ†ç»„åˆ‡æ¢ç­‰ */}
    </div>
  );
}
```
- **æ³¨æ„äº‹é¡¹**ï¼š
  - ä»ªè¡¨ç›˜é¡µé¢ä¸ä¸»æµç¨‹é¡µé¢åˆ†ç¦»ï¼Œä¾¿äºç‹¬ç«‹å¼€å‘ã€ç»´æŠ¤å’Œæƒé™æ§åˆ¶ã€‚
  - æ¨èä»ªè¡¨ç›˜é¡µé¢ä»…èšåˆå’Œå±•ç¤º API æ•°æ®ï¼Œä¸ç›´æ¥ä¾èµ–ä¸»æµç¨‹é¡µé¢çŠ¶æ€ã€‚
  - å¯æ ¹æ®å›¢é˜Ÿéœ€æ±‚æ‰©å±•ä¸ºå¤šåˆ†ç»„åˆ‡æ¢ã€è¶‹åŠ¿å¯¹æ¯”ã€å·®å¼‚é«˜äº®ç­‰é«˜çº§ç”¨ä¾‹ã€‚

> **å»ºè®®**ï¼šè¿ç§»/æ–°é¡¹ç›®è½åœ°æ—¶ï¼Œä¼˜å…ˆåˆ†ç¦»ä»ªè¡¨ç›˜é¡µé¢ï¼Œé‡‡ç”¨å®Œæ•´æ¨¡æ¿ï¼Œåç»­å¯æŒ‰éœ€æ‰©å±•å¯è§†åŒ–èƒ½åŠ›ã€‚

---

### 3.4 æŠ¥å‘Šä¸ç´¢å¼•è‡ªåŠ¨åŒ–

- **è‡ªåŠ¨å½’æ¡£**ï¼šæ¯æ¬¡æµ‹è¯•åè‡ªåŠ¨ç”Ÿæˆè¯¦ç»† Markdown æŠ¥å‘Šå’Œç´¢å¼•ï¼ˆè§ playwright-test-logs/index.mdï¼‰ã€‚
- **ç´¢å¼•è¡¨æ ¼**ï¼š
  ```markdown
  | æµ‹è¯•æŠ¥å‘Š | ç‰ˆæœ¬å· | æ¨¡å¼ | å—æ•° | èµ„æºåŠ è½½ (ms) | ç«¯åˆ°ç«¯åŠ è½½ (ms) | ... |
  |---|---|---|---|---|---|---|
  | [2025-07-06 00:55](test-report-20250706005512.md) | 1.3.20 | ç”Ÿäº§ | 14 | âœ… 14 | âœ… 1322 | ... |
  ```
- **å·¥ç¨‹æ•ˆæœ**ï¼šå›¢é˜Ÿå¯éšæ—¶æŸ¥é˜…å†å²æŠ¥å‘Šï¼Œæ”¯æŒè¶‹åŠ¿åˆ†æä¸æ€§èƒ½å›æº¯ã€‚

---

## 4. å®‰å…¨ä¸å·¥ç¨‹è§„èŒƒ

### 4.1 æµ‹è¯•APIå®‰å…¨æš´éœ²åŸåˆ™
- `window.testAPI` ä»…åœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒæŒ‚è½½ï¼Œç”Ÿäº§ç¯å¢ƒç»ä¸æš´éœ²åé—¨ã€‚
- çœŸå®å®ç°ï¼š
  ```tsx
  // contexts/GameContext.tsx
  useEffect(() => {
    if (process.env.NODE_ENV !== 'production') {
      window.testAPI = {
        selectPieceForTest: (id) => dispatch({ type: 'SELECT_PIECE', payload: id }),
        rotatePieceForTest: () => dispatch({ type: 'ROTATE_PIECE' }),
        resetPiecePositionForTest: (id) => dispatch({ type: 'RESET_PIECE_POSITION', payload: id }),
        markPieceAsCompletedForTest: (id) => dispatch({ type: 'MARK_PIECE_COMPLETED', payload: id }),
      };
    }
  }, [dispatch]);
  ```
- Playwright æ–­è¨€ç¯å¢ƒå®‰å…¨ï¼š
  ```js
  // e2e/full_game_flow.spec.ts
  const envMode = await page.evaluate(() => window.__ENV_MODE__);
  expect(["development", "production"]).toContain(envMode);
  ```

### 4.2 æµ‹è¯•æ•°æ®ä¸æŠ¥å‘Šéš”ç¦»ä¸åŒæ­¥è§„èŒƒ
- æ‰€æœ‰æµ‹è¯•ç»“æœã€æŠ¥å‘Šã€æ—¥å¿—ä»…æœ¬åœ°ä¿å­˜ï¼Œ`.gitignore` é…ç½®åªä¿ç•™ `.gitkeep`ï¼Œé˜²æ­¢æ•æ„Ÿæ•°æ®æ³„æ¼ã€‚
- çœŸå®é…ç½®ï¼š
  ```gitignore
  playwright-test-logs/*
  !playwright-test-logs/.gitkeep
  playwright-report/*
  !playwright-report/.gitkeep
  test-results/*
  !test-results/.gitkeep
  ```
- ç›®å½•ç»“æ„ä¸åŒæ­¥è§„èŒƒè§ `project_structure.md`ï¼Œå›¢é˜Ÿåä½œæ—¶ç›®å½•å§‹ç»ˆä¸€è‡´ã€‚

### 4.3 ä¾èµ–ä¸ç‰ˆæœ¬å®‰å…¨ã€æƒé™è¾¹ç•Œ
- Playwrightã€Node.js ç‰ˆæœ¬é”å®šï¼Œé¿å…ä¾èµ–æ¼æ´å’Œç¯å¢ƒå·®å¼‚ã€‚
- package.json ç¤ºä¾‹ï¼š
  ```json
  "devDependencies": {
    "@playwright/test": "^1.43.1",
    "node": ">=18.0.0"
  }
  ```
- API ä»…èšåˆæœ¬åœ°æ–‡ä»¶ï¼Œæ— å¤–éƒ¨å†™å…¥æˆ–æ•æ„Ÿæ“ä½œï¼Œå®‰å…¨å¯æ§ã€‚
- å‰ç«¯/åç«¯æƒé™è¾¹ç•Œæ¸…æ™°ï¼Œæ‰€æœ‰èšåˆAPIåªè¯»ã€‚

---

## 5. ç¯å¢ƒä¸ç›®å½•é…ç½®

### 5.1 Next.js 13+ App Router ç»“æ„ä¸é¡µé¢è§„èŒƒ

> **é‡è¦ï¼šæ‰€æœ‰é¡µé¢å¿…é¡»ä¸¥æ ¼éµå¾ª Next.js 13+ App Router ç›®å½•è§„èŒƒï¼Œå¦åˆ™ä¼šå‡ºç° 404 æˆ–é¡µé¢æ— æ•ˆã€‚**

- **ä¸»äº¤äº’é¡µé¢**ï¼š`app/page.tsx`
- **ä¸» layout**ï¼š`app/layout.tsx`
- **ä»ªè¡¨ç›˜é¡µé¢**ï¼ˆæ¨èå•ç‹¬è·¯ç”±ï¼‰ï¼š`app/test/dashboard/page.tsx`
- **ä»ªè¡¨ç›˜ layout**ï¼ˆå¦‚æœ‰åµŒå¥—è·¯ç”±ï¼‰ï¼š`app/test/layout.tsx`

**æ¨èç›®å½•ç»“æ„ï¼š**
```
app/
  layout.tsx                # å…¨å±€å¸ƒå±€
  page.tsx                  # ä¸»äº¤äº’é¡µé¢
  test/
    layout.tsx              # ä»ªè¡¨ç›˜å¸ƒå±€ï¼ˆå¯é€‰ï¼‰
    dashboard/
      page.tsx              # ä»ªè¡¨ç›˜é¡µé¢
```

**ä»ªè¡¨ç›˜é¡µé¢å®Œæ•´æ¨¡æ¿ï¼š**
```tsx
// app/test/dashboard/page.tsx
import { useEffect, useState } from 'react';

export default function Dashboard() {
  const [trendData, setTrendData] = useState([]);
  useEffect(() => {
    fetch('/api/performance-trend')
      .then(res => res.json())
      .then(setTrendData);
  }, []);
  return (
    <div>
      <h2>è‡ªåŠ¨åŒ–æµ‹è¯•è¶‹åŠ¿ä»ªè¡¨ç›˜</h2>
      <pre>{JSON.stringify(trendData, null, 2)}</pre>
      {/* å¯æ‰©å±•ä¸ºè¡¨æ ¼ã€è¶‹åŠ¿å›¾ç­‰ */}
    </div>
  );
}
```

---

### 5.2 ç›®å½•ç»“æ„æ ‘ä¸å·¥ç¨‹åˆ†å±‚

æœ¬é¡¹ç›®é‡‡ç”¨åˆ†å±‚ç›®å½•ç»“æ„ï¼Œä¸»æµç¨‹ã€ä¸´æ—¶æµ‹è¯•ã€æŠ¥å‘Šã€APIã€å‰ç«¯ä»ªè¡¨ç›˜ç­‰åˆ†æ˜ï¼Œä¾¿äºåä½œå’Œç»´æŠ¤ã€‚

```
project-root/
  app/
    api/performance-trend/route.ts   # API èšåˆ
    test/page.tsx                    # å‰ç«¯ä»ªè¡¨ç›˜
  e2e/
    full_game_flow.spec.ts           # ä¸»æµç¨‹æµ‹è¯•è„šæœ¬
    temp/                            # ä¸´æ—¶/ä¸“é¡¹æµ‹è¯•è„šæœ¬
  scripts/
    archive-test-results.js          # å½’æ¡£è„šæœ¬
  playwright-test-logs/              # æµ‹è¯•æŠ¥å‘Šå½’æ¡£ï¼ˆä»… .gitkeepï¼‰
  playwright-report/                 # Playwright HTMLæŠ¥å‘Šï¼ˆä»… .gitkeepï¼‰
  test-results/                      # Playwright åŸå§‹ç»“æœï¼ˆä»… .gitkeepï¼‰
  ...
```

### 5.2.1 é™æ€èµ„æºæš´éœ²ä¸APIèšåˆ

> **å·¥ç¨‹è¦ç‚¹ï¼šPlaywright å½’æ¡£æŠ¥å‘Šã€æ€§èƒ½æ•°æ®ç­‰éœ€æš´éœ²ä¸ºé™æ€èµ„æºï¼Œä¾›å‰ç«¯ä»ªè¡¨ç›˜/APIèšåˆè®¿é—®ã€‚**

- æ¨èå°† `playwright-test-logs/` ç›®å½•ä¸‹çš„æŠ¥å‘Šï¼ˆå¦‚ .mdã€.jsonï¼‰**åŒæ­¥æˆ–è½¯é“¾åˆ° `public/` ç›®å½•**ï¼Œç¡®ä¿ Next.js å‰ç«¯é¡µé¢å’Œ API è·¯ç”±å‡å¯ç›´æ¥ fetch è®¿é—®ã€‚
- å…¸å‹åšæ³•ï¼š
  - å½’æ¡£è„šæœ¬è‡ªåŠ¨å°†æœ€æ–°æŠ¥å‘Šå¤åˆ¶/è½¯é“¾åˆ° `public/playwright-test-logs/` ä¸‹ã€‚
  - Next.js API è·¯ç”±ï¼ˆå¦‚ `/api/performance-trend`ï¼‰ç›´æ¥è¯»å– `public/playwright-test-logs/` ä¸‹çš„æ–‡ä»¶ï¼Œèšåˆä¸ºè¶‹åŠ¿æ•°æ®ã€‚
- ä»£ç ç¤ºä¾‹ï¼š
```js
// scripts/archive-test-results.js
const fse = require('fs-extra');
const srcDir = 'playwright-test-logs';
const destDir = 'public/playwright-test-logs';
fse.ensureDirSync(destDir);
fse.copySync(srcDir, destDir, { overwrite: true });
```

- Next.js API èšåˆç¤ºä¾‹ï¼š
```ts
// app/api/performance-trend/route.ts
import fs from 'fs';
import path from 'path';
export async function GET() {
  const logDir = path.join(process.cwd(), 'public/playwright-test-logs');
  const files = fs.readdirSync(logDir).filter(f => f.endsWith('.md'));
  const trendData = files.map(file => {
    const content = fs.readFileSync(path.join(logDir, file), 'utf-8');
    const match = content.match(/<!--\s*(\{[\s\S]*?\})\s*-->/);
    if (match && match[1]) {
      return JSON.parse(match[1]);
    }
    return null;
  }).filter(Boolean);
  return new Response(JSON.stringify(trendData.reverse()));
}
```

- **æ³¨æ„äº‹é¡¹**ï¼š
  - `playwright-test-logs/` ç›®å½•æœ¬èº«åº”é€šè¿‡ `.gitignore` æ’é™¤ï¼Œä»…ä¿ç•™ `.gitkeep`ï¼Œé˜²æ­¢å¤§æ–‡ä»¶è¯¯æäº¤ã€‚
  - å½’æ¡£è„šæœ¬å’Œ API è·¯ç”±éœ€åŒæ­¥ç»´æŠ¤ï¼Œä¿è¯å‰ç«¯ä»ªè¡¨ç›˜æ•°æ®æºå§‹ç»ˆå¯ç”¨ã€‚
  - å¦‚éœ€æ”¯æŒå¤šç¯å¢ƒ/å¤šåˆ†ç»„ï¼Œå»ºè®®åœ¨æ–‡ä»¶åæˆ–å†…å®¹ä¸­å¢åŠ åˆ†ç»„å­—æ®µï¼ŒAPI èšåˆæ—¶è‡ªåŠ¨åˆ†ç»„ã€‚

> è¿™æ ·å¯ç¡®ä¿å‰ç«¯ä»ªè¡¨ç›˜ã€APIèšåˆã€è¶‹åŠ¿åˆ†æç­‰åŠŸèƒ½åœ¨ä»»ä½•éƒ¨ç½²ç¯å¢ƒä¸‹éƒ½èƒ½ç¨³å®šè®¿é—®å½’æ¡£æŠ¥å‘Šå’Œæ€§èƒ½æ•°æ®ã€‚

### 5.3 .gitignore/.gitkeep é…ç½®è¦ç‚¹
- åªä¿ç•™ .gitkeepï¼Œæ‰€æœ‰æµ‹è¯•ç»“æœã€æŠ¥å‘Šä¸ä¸Šä¼ ï¼Œä¿è¯ç›®å½•ç»“æ„åŒæ­¥ã€‚
- çœŸå®é…ç½®ï¼š
  ```gitignore
  playwright-test-logs/*
  !playwright-test-logs/.gitkeep
  playwright-report/*
  !playwright-report/.gitkeep
  test-results/*
  !test-results/.gitkeep
  ```
- ç›®å½•ç»“æ„ä¸æ–‡æ¡£åŒæ­¥ä¿®è®¢ï¼Œå›¢é˜Ÿåä½œé›¶éšœç¢ã€‚

### 5.4 Playwright é…ç½®ä¸ç¯å¢ƒåˆ†ç»„
- ä¸´æ—¶æµ‹è¯•ä¸ä¸»æµç¨‹æµ‹è¯•åˆ†ç¦»ï¼Œ`e2e/temp/` ç›®å½•ä¸“ç”¨äºä¸“é¡¹/è°ƒè¯•è„šæœ¬ã€‚
- Playwright é…ç½®éš”ç¦»ä¸´æ—¶æµ‹è¯•ï¼š
  ```js
  // playwright.config.ts
  testIgnore: ['e2e/temp/**'],
  ```
- ç¯å¢ƒåˆ†ç»„ï¼šNext.js å®¢æˆ·ç«¯æŒ‚è½½ `window.__ENV_MODE__`ï¼ŒPlaywright é‡‡é›†ï¼ŒAPI/å‰ç«¯/æŠ¥å‘Šå…¨é“¾è·¯åˆ†ç»„ã€‚
  ```tsx
  // app/layout.tsx
  useEffect(() => {
    window.__ENV_MODE__ = process.env.NODE_ENV === 'production' ? 'production' : 'development';
  }, []);
  ```
  ```js
  // e2e/full_game_flow.spec.ts
  const envMode = await page.evaluate(() => window.__ENV_MODE__);
  expect(["development", "production"]).toContain(envMode);
```

### 5.4.1 Playwright å®‰è£…ä¸åˆå§‹åŒ–

- æ¨èä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–é¡¹ç›®ï¼Œè‡ªåŠ¨ç”Ÿæˆé…ç½®å’Œç›®å½•ç»“æ„ï¼š
  ```bash
  npm init playwright@latest
  ```
- å®‰è£…ä¾èµ–ï¼ˆå¦‚éœ€å‡çº§ï¼‰ï¼š
  ```bash
  npm install -D @playwright/test@latest
  ```
- å®‰è£…æŒ‡å®šæµè§ˆå™¨ï¼ˆå¦‚ä»…éœ€ Chromiumï¼‰ï¼š
  ```bash
  npx playwright install chromium --with-deps
  ```

#### 5.4.1.1 ä¾èµ–å£°æ˜ä¸ä¸€é”®å®‰è£…

> **å·¥ç¨‹è¦ç‚¹ï¼šæ‰€æœ‰å½’æ¡£è„šæœ¬ã€APIèšåˆã€æ€§èƒ½é‡‡é›†ç­‰ä¾èµ–éœ€åœ¨è¿ç§»/åˆå§‹åŒ–æ—¶ä¸€æ¬¡æ€§å£°æ˜ï¼Œé¿å…é—æ¼å¯¼è‡´æµç¨‹ä¸­æ–­ã€‚**

- æ¨èåœ¨ `package.json` ä¸­æ˜¾å¼å£°æ˜æ‰€æœ‰å¿…éœ€ä¾èµ–ï¼Œå°¤å…¶æ˜¯ `fs-extra`ã€`@playwright/test`ã€`next`ã€`react`ã€`react-dom` ç­‰ã€‚
- å…¸å‹ä¾èµ–å£°æ˜ï¼š
```json
"devDependencies": {
  "@playwright/test": "^1.43.1",
  "fs-extra": "^11.1.1"
},
"dependencies": {
  "next": "^13.4.19",
  "react": "^18.2.0",
  "react-dom": "^18.2.0"
}
```
- ä¸€é”®å®‰è£…å‘½ä»¤ï¼š
```bash
npm install
```
- å¦‚éœ€å‡çº§ Playwright åŠç›¸å…³ä¾èµ–ï¼š
```bash
npm install -D @playwright/test@latest fs-extra@latest
```
- è¿ç§»/åˆå§‹åŒ– checklistï¼š
  - [ ] package.json ä¸­æ‰€æœ‰ä¾èµ–å£°æ˜é½å…¨
  - [ ] `npm install` ä¸€æ¬¡æ€§å®‰è£…å…¨éƒ¨ä¾èµ–
  - [ ] å½’æ¡£è„šæœ¬ã€APIèšåˆã€å‰ç«¯ä»ªè¡¨ç›˜ç­‰å‡å¯ç›´æ¥è¿è¡Œ

> **å»ºè®®**ï¼šåœ¨æ–‡æ¡£å’Œæ¨¡æ¿å·¥ç¨‹ä¸­åŒæ­¥ç»´æŠ¤ä¾èµ–å£°æ˜ï¼Œå›¢é˜Ÿåä½œå’Œæ–°é¡¹ç›®è¿ç§»æ—¶å¯ä¸€é”®è½åœ°ï¼Œæ— éœ€æ‰‹åŠ¨è¡¥ä¾èµ–ã€‚

### 5.4.2 ç‰ˆæœ¬ç®¡ç†ä¸å®šæœŸå‡çº§

- å»ºè®®å®šæœŸå‡çº§ Playwright ç‰ˆæœ¬ï¼Œä¿æŒä¸å®˜æ–¹åŒæ­¥ï¼Œé¿å…APIå˜æ›´å¯¼è‡´è„šæœ¬å¤±æ•ˆã€‚
  ```bash
  npx playwright --version
  npm install -D @playwright/test@latest
  ```
- æ¨èåœ¨ CI/æœ¬åœ°å®šæœŸæ£€æŸ¥ Playwright ç‰ˆæœ¬ï¼Œå¹¶å…³æ³¨[å®˜æ–¹å‘å¸ƒæ—¥å¿—](https://playwright.dev/docs/release-notes)ã€‚
- è„šæœ¬ä¸ Playwright ç‰ˆæœ¬ã€é…ç½®æ–‡ä»¶éœ€åŒæ­¥ç»´æŠ¤ï¼Œå‡çº§åå»ºè®®å…¨é“¾è·¯å›å½’ã€‚

### 5.4.3 å…³é”®é…ç½®ä¸å¤šç«¯ï¼ˆMCPï¼‰ç¤ºä¾‹

- å…¸å‹ playwright.config.ts é…ç½®ï¼ˆå«å¤šæµè§ˆå™¨ã€å¤šç¯å¢ƒã€webServerï¼‰ï¼š
  ```js
import { defineConfig, devices } from '@playwright/test';
export default defineConfig({
  testDir: './e2e',
    testIgnore: ['e2e/temp/**'],
    outputDir: 'test-results',
    reporter: [['list'], ['html', { outputFolder: 'playwright-report' }]],
    timeout: 30000,
    expect: { timeout: 5000 },
    projects: [
      { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
      { name: 'firefox', use: { ...devices['Desktop Firefox'] } },
      { name: 'webkit', use: { ...devices['Desktop Safari'] } },
    ],
  use: {
      baseURL: 'http://localhost:3000',
      headless: true,
      trace: 'on-first-retry',
    },
  webServer: {
      command: 'npm run dev',
      url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
    workers: process.env.CI ? 1 : 2,
    forbidOnly: !!process.env.CI,
    retries: process.env.CI ? 2 : 0,
});
```
- å…³é”®é…ç½®è¯´æ˜ï¼š
  - `testDir`ï¼šæµ‹è¯•è„šæœ¬ç›®å½•ï¼ˆæœ¬é¡¹ç›®ä¸º `e2e/`ï¼‰
  - `testIgnore`ï¼šå¿½ç•¥ä¸´æ—¶/ä¸“é¡¹æµ‹è¯•ï¼ˆæœ¬é¡¹ç›®ä¸º `e2e/temp/`ï¼‰
  - `projects`ï¼šå¤šç«¯/å¤šæµè§ˆå™¨é…ç½®ï¼ˆMCPï¼‰
  - `webServer`ï¼šè‡ªåŠ¨å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼Œé€‚é…CI
  - `workers`ã€`forbidOnly`ã€`retries`ï¼šCIä¸‹æ¨èé…ç½®

### 5.4.4 æŒ‡ä»¤ä¸æµç¨‹è§„èŒƒ

- **ä¸»æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯•ä¸å½’æ¡£**ï¼š
  ```bash
  npm run test:e2e
  ```
  - å…ˆè¿è¡Œæ‰€æœ‰ Playwright æµ‹è¯•ï¼Œå†è‡ªåŠ¨æ‰§è¡Œå½’æ¡£è„šæœ¬ `scripts/archive-test-results.js`ï¼Œç”Ÿæˆæ ‡å‡†åŒ– Markdown æŠ¥å‘Šåˆ° `playwright-test-logs/`ã€‚
- **ä»…è¿è¡Œ Playwright æµ‹è¯•ï¼ˆä¸å½’æ¡£ï¼‰**ï¼š
  ```bash
  npm run test
  ```
- **æŸ¥çœ‹ HTML æµ‹è¯•æŠ¥å‘Š**ï¼š
  ```bash
  npm run test:report
  ```
- **è°ƒè¯•/å¼€å‘æ¨¡å¼**ï¼š
  ```bash
  npx playwright test --ui
  ```
- **ä¸´æ—¶/ä¸“é¡¹æµ‹è¯•éš”ç¦»**ï¼š
  - æ‰€æœ‰ä¸´æ—¶/ä¸“é¡¹æµ‹è¯•è„šæœ¬å­˜æ”¾äº `e2e/temp/`ï¼Œä¸»æµç¨‹æµ‹è¯•ç¯å¢ƒå§‹ç»ˆçº¯å‡€ã€‚
  - é€šè¿‡ `testIgnore` é…ç½®ï¼Œç¡®ä¿ä¸»æµç¨‹ä¸ä¸´æ—¶æµ‹è¯•äº’ä¸å¹²æ‰°ã€‚

### 5.4.5 æµ‹è¯•ç»“æœä¸æŠ¥å‘Šç›®å½•

- `test-results/`ï¼šåŸå§‹æµ‹è¯•ç»“æœï¼Œä¾›å½’æ¡£è„šæœ¬åˆ†æã€‚
- `playwright-report/`ï¼šHTMLæŠ¥å‘Šï¼Œä¾¿äºå¯è§†åŒ–å›æº¯ã€‚
- `playwright-test-logs/`ï¼šå½’æ¡£åçš„æ ‡å‡†åŒ– Markdown æŠ¥å‘Šï¼Œä¾›å‰ç«¯èšåˆã€‚

### 5.4.6 ç»´æŠ¤ä¸å·¥ç¨‹å»ºè®®

- Playwright ç‰ˆæœ¬å‡çº§åï¼Œå»ºè®®åŒæ­¥ review/ç»´æŠ¤æ‰€æœ‰ E2E è„šæœ¬ï¼Œé¿å…APIå˜æ›´å¯¼è‡´è„šæœ¬å¤±æ•ˆã€‚
- æ¨èåœ¨ CI/æœ¬åœ°åŠ å…¥ Playwright ç‰ˆæœ¬å’Œè„šæœ¬ lint/type checkï¼ˆå¦‚ tsc --noEmitã€ESLintã€@typescript-eslint/no-floating-promisesï¼‰ã€‚
- å»ºè®®å°† playwright.config.tsã€å½’æ¡£è„šæœ¬ã€æµ‹è¯•æŒ‡ä»¤çº³å…¥æ¨¡æ¿ä»“åº“ï¼Œå›¢é˜Ÿç»Ÿä¸€é…ç½®ã€‚
- æ‰€æœ‰æ–‡æ¡£ã€READMEã€åä½œè¯´æ˜éœ€ä¸å®é™…æŒ‡ä»¤ã€æµç¨‹ã€ç›®å½•ä¿æŒä¸€è‡´ã€‚

---

## 6. åœºæ™¯ä¸æµç¨‹å®å½•

### 6.1 å…¸å‹æµ‹è¯•åœºæ™¯å…¨æµç¨‹æ¼”ç¤º

ä»¥"å®Œæ•´è‡ªåŠ¨åŒ–æ‹¼å›¾æµç¨‹"ä¸ºä¾‹ï¼Œå±•ç¤ºä»æµ‹è¯•è¿è¡Œåˆ°æŠ¥å‘Šå½’æ¡£ã€å‰ç«¯å¯è§†åŒ–çš„å…¨é“¾è·¯é—­ç¯ã€‚

#### æ­¥éª¤1ï¼šè¿è¡Œæµ‹è¯•
```bash
npm run test:e2e
```
æˆ–åœ¨CIä¸­è‡ªåŠ¨è§¦å‘ã€‚

#### 6.1.1 å¼€å‘æµ‹è¯•å·¥ä½œæµï¼ˆDevï¼‰

**ç›®æ ‡**ï¼šé«˜æ•ˆè°ƒè¯•ã€æµç¨‹è·³è½¬ã€æç«¯/å¼‚å¸¸åœºæ™¯è¦†ç›–ï¼Œä¾¿äºå¼€å‘å’Œæµ‹è¯•å·¥ç¨‹å¸ˆå¿«é€Ÿå®šä½é—®é¢˜ã€‚

> **æ³¨æ„ï¼šæœ¬é¡¹ç›®å·²å®ç°è‡ªåŠ¨è¯†åˆ«å¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼Œæµ‹è¯•å‘½ä»¤æ— éœ€æ‰‹åŠ¨è®¾ç½® NODE_ENVã€‚**

1. **å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ**
   ```bash
   npm run dev
   ```
2. **è¿è¡Œå¼€å‘ç¯å¢ƒä¸‹çš„è‡ªåŠ¨åŒ–æµ‹è¯•**
   ```bash
   npm run test:e2e
   ```
3. **æµç¨‹é©±åŠ¨ä¸æ–­è¨€**
   - å¯é€šè¿‡ `window.testAPI` ç›´æ¥é©±åŠ¨æµç¨‹ã€æ¨¡æ‹ŸçŠ¶æ€ã€‚
   - æ–­è¨€ä»¥æç¤ºåŒºåŸŸå”¯ä¸€å†…å®¹ä¸ºå‡†ã€‚
   ```js
   // e2e/full_game_flow.spec.ts
   await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©ä¸€ä¸ªå½¢çŠ¶');
   await page.evaluate(() => window.testAPI.selectPieceForTest(1)); // ç›´æ¥è·³è½¬
   await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©åˆ‡å‰²ç±»å‹');
   // ...å¯æ’å…¥å¼‚å¸¸/è¾¹ç•Œæµç¨‹
   ```
4. **é‡‡é›†ä¸æŠ¥å‘Š**
   - å¯é‡‡é›† mock/æµ‹è¯•æ•°æ®ï¼Œè¦†ç›–æç«¯åœºæ™¯ã€‚
   - ç”Ÿæˆçš„æŠ¥å‘Šã€APIã€å‰ç«¯ä»ªè¡¨ç›˜å‡æ ‡è®°ä¸º"å¼€å‘ç¯å¢ƒ"ï¼Œæ”¯æŒåˆ†ç»„ã€å¯¹æ¯”ã€‚
5. **å¯è§†åŒ–ä¸è°ƒè¯•**
   - å‰ç«¯ä»ªè¡¨ç›˜å¯åˆ‡æ¢åˆ°"å¼€å‘"åˆ†ç»„ï¼ŒæŸ¥çœ‹æ‰€æœ‰å¼€å‘ç¯å¢ƒä¸‹çš„æµ‹è¯•æ•°æ®ã€è¶‹åŠ¿ã€å·®å¼‚é«˜äº®ã€‚

---

#### 6.1.2 ç”Ÿäº§æµ‹è¯•å·¥ä½œæµï¼ˆProdï¼‰

**ç›®æ ‡**ï¼šéªŒè¯çœŸå®ç”¨æˆ·è·¯å¾„ã€é‡‡é›†çœŸå®æ€§èƒ½æ•°æ®ã€ç›‘æ§å›å½’ä¸è¶‹åŠ¿ã€‚

> **æ³¨æ„ï¼šæœ¬é¡¹ç›®å·²å®ç°è‡ªåŠ¨è¯†åˆ«å¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼Œæµ‹è¯•å‘½ä»¤æ— éœ€æ‰‹åŠ¨è®¾ç½® NODE_ENVã€‚**

1. **éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ**
  ```bash
   npm run build && npm start
   # æˆ– CI/CD è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§æœåŠ¡å™¨
  ```
2. **è¿è¡Œç”Ÿäº§ç¯å¢ƒä¸‹çš„è‡ªåŠ¨åŒ–æµ‹è¯•**
  ```bash
   npm run test:e2e
   ```
3. **æµç¨‹é©±åŠ¨ä¸æ–­è¨€**
   - ä¸å…è®¸ä»»ä½• testAPI æ³¨å…¥ï¼Œæ‰€æœ‰æµç¨‹å¿…é¡»èµ°çœŸå®ç”¨æˆ·è·¯å¾„ã€‚
   - æ–­è¨€åŒæ ·ä»¥æç¤ºåŒºåŸŸå”¯ä¸€å†…å®¹ä¸ºå‡†ã€‚
   ```js
   // e2e/full_game_flow.spec.ts
   await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©ä¸€ä¸ªå½¢çŠ¶');
   // ä¸èƒ½ç”¨ window.testAPIï¼Œå¿…é¡»çœŸå®ç‚¹å‡»/æ“ä½œ
   await page.click('[data-piece-id="1"]');
   await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©åˆ‡å‰²ç±»å‹');
   // ...
   ```
4. **é‡‡é›†ä¸æŠ¥å‘Š**
   - ä»…é‡‡é›†çœŸå®ç”¨æˆ·è·¯å¾„ä¸‹çš„æ€§èƒ½æ•°æ®ã€‚
   - ç”Ÿæˆçš„æŠ¥å‘Šã€APIã€å‰ç«¯ä»ªè¡¨ç›˜å‡æ ‡è®°ä¸º"ç”Ÿäº§ç¯å¢ƒ"ï¼Œæ”¯æŒä¸å¼€å‘ç¯å¢ƒå¯¹æ¯”ã€‚
5. **å¯è§†åŒ–ä¸ç›‘æ§**
   - å‰ç«¯ä»ªè¡¨ç›˜åˆ‡æ¢åˆ°"ç”Ÿäº§"åˆ†ç»„ï¼ŒæŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒä¸‹çš„çœŸå®æ€§èƒ½è¶‹åŠ¿ã€å›å½’ç›‘æ§ã€å·®å¼‚é«˜äº®ã€‚

---

##### å…¸å‹å¯¹æ¯”è¡¨

| æ­¥éª¤         | å¼€å‘æµ‹è¯•å·¥ä½œæµï¼ˆDevï¼‰                | ç”Ÿäº§æµ‹è¯•å·¥ä½œæµï¼ˆProdï¼‰                |
|--------------|-------------------------------------|---------------------------------------|
| å¯åŠ¨å‘½ä»¤     | `npm run dev` + `npm run test:e2e`  | `npm run build && npm start` + `npm run test:e2e` |
| æµç¨‹é©±åŠ¨     | æ”¯æŒ `window.testAPI` è·³è½¬/æ¨¡æ‹Ÿ      | ä»…å…è®¸çœŸå®ç”¨æˆ·æ“ä½œ                    |
| æ•°æ®é‡‡é›†     | å¯ç”¨ mock/æµ‹è¯•æ•°æ®ï¼Œè¦†ç›–æç«¯åœºæ™¯      | ä»…é‡‡é›†çœŸå®ç”¨æˆ·è·¯å¾„ã€çœŸå®æ€§èƒ½æ•°æ®      |
| æŠ¥å‘Šåˆ†ç»„     | æ ‡è®°ä¸º"å¼€å‘ç¯å¢ƒ"ï¼Œæ”¯æŒåˆ†ç»„/å¯¹æ¯”      | æ ‡è®°ä¸º"ç”Ÿäº§ç¯å¢ƒ"ï¼Œæ”¯æŒåˆ†ç»„/å¯¹æ¯”      |
| å¯è§†åŒ–       | ä»ªè¡¨ç›˜åˆ‡æ¢"å¼€å‘"åˆ†ç»„ï¼Œè°ƒè¯•/è¶‹åŠ¿åˆ†æ  | ä»ªè¡¨ç›˜åˆ‡æ¢"ç”Ÿäº§"åˆ†ç»„ï¼Œç›‘æ§/è¶‹åŠ¿åˆ†æ  |

---

### 6.2 å›¢é˜Ÿåä½œä¸‹çš„æµç¨‹åˆ†å·¥

- **å¼€å‘/æµ‹è¯•å·¥ç¨‹å¸ˆ**ï¼šè´Ÿè´£ç¼–å†™/ç»´æŠ¤ Playwright è„šæœ¬ã€å½’æ¡£è„šæœ¬ã€æ€§èƒ½é‡‡é›†ç‚¹ã€‚
- **å‰ç«¯å·¥ç¨‹å¸ˆ**ï¼šè´Ÿè´£ä»ªè¡¨ç›˜é¡µé¢ã€APIèšåˆã€å¯è§†åŒ–äº¤äº’ã€‚
- **CI/DevOps**ï¼šè´Ÿè´£é›†æˆè‡ªåŠ¨åŒ–æµ‹è¯•ã€æŠ¥å‘Šå½’æ¡£ã€ç›®å½•åŒæ­¥ã€‚
- **å›¢é˜Ÿåä½œè¦ç‚¹**ï¼š
  - ç›®å½•ç»“æ„ã€å­—æ®µã€æµç¨‹ã€APIã€å‰ç«¯ã€æŠ¥å‘Šå…¨é“¾è·¯ä¸€è‡´
  - å˜æ›´éœ€åŒæ­¥ä¿®è®¢æ–‡æ¡£ï¼Œä¿è¯åä½œé›¶éšœç¢

### 6.3 å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•ä¸æ•°æ®å·®å¼‚è¯´æ˜

- **ç¯å¢ƒè¯†åˆ«æœºåˆ¶**  
  - Next.js å®¢æˆ·ç«¯æŒ‚è½½ `window.__ENV_MODE__`ï¼ŒPlaywright é‡‡é›†ï¼ŒAPI/å‰ç«¯/æŠ¥å‘Šå…¨é“¾è·¯åˆ†ç»„ã€‚
  - ä»£ç ç¤ºä¾‹ï¼š
    ```tsx
    // app/layout.tsx
    useEffect(() => {
      window.__ENV_MODE__ = process.env.NODE_ENV === 'production' ? 'production' : 'development';
    }, []);
    ```
    ```js
    // e2e/full_game_flow.spec.ts
    const envMode = await page.evaluate(() => window.__ENV_MODE__);
    expect(["development", "production"]).toContain(envMode);
    ```

- **æµ‹è¯•æµç¨‹å·®å¼‚**  
  - å¼€å‘ç¯å¢ƒï¼š`window.testAPI` å¯é©±åŠ¨æµç¨‹ã€æ¨¡æ‹ŸçŠ¶æ€ï¼Œä¾¿äºè°ƒè¯•ã€‚
  - ç”Ÿäº§ç¯å¢ƒï¼šæ— ä»»ä½•æµ‹è¯•APIæš´éœ²ï¼Œä»…å…è®¸çœŸå®ç”¨æˆ·è·¯å¾„ã€‚

- **æµ‹è¯•æ•°æ®å·®å¼‚**  
  - å¼€å‘ç¯å¢ƒï¼šå¯ç”¨ mock/æµ‹è¯•æ•°æ®ï¼Œè¦†ç›–æç«¯/å¼‚å¸¸åœºæ™¯ã€‚
  - ç”Ÿäº§ç¯å¢ƒï¼šä»…é‡‡é›†çœŸå®ç”¨æˆ·è·¯å¾„ã€çœŸå®æ€§èƒ½æ•°æ®ã€‚

- **æŠ¥å‘Šä¸å¯è§†åŒ–å·®å¼‚**  
  - å‰ç«¯ä»ªè¡¨ç›˜ã€APIã€æŠ¥å‘Šå‡æ”¯æŒæŒ‰ç¯å¢ƒåˆ†ç»„ã€åˆ‡æ¢ã€å¯¹æ¯”ï¼Œè‡ªåŠ¨é«˜äº®å·®å¼‚ã€‚
  - ç¤ºä¾‹è¡¨æ ¼ï¼š
    | ç¯å¢ƒ | èµ„æºåŠ è½½(ms) | ç«¯åˆ°ç«¯åŠ è½½(ms) | FPS | ... |
    |------|--------------|---------------|-----|-----|
    | å¼€å‘ | 14           | 1322          | 60  | ... |
    | ç”Ÿäº§ | 950          | 1750          | 58  | ... |

- **å·¥ç¨‹è½åœ°å»ºè®®**  
  - å®šæœŸå¯¹æ¯”å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•ç»“æœï¼ŒåŠæ—¶å‘ç°ç¯å¢ƒç‰¹æœ‰é—®é¢˜ã€‚
  - æ‰€æœ‰ç¯å¢ƒåˆ†ç»„å­—æ®µã€æµç¨‹ã€æŠ¥å‘Šç»“æ„ä¿æŒä¸€è‡´ï¼Œä¾¿äºè‡ªåŠ¨èšåˆä¸è¶‹åŠ¿åˆ†æã€‚

---

## 7. å¸¸è§é—®é¢˜ä¸æ’æŸ¥

### 7.1 æµ‹è¯•æµç¨‹å‡å¤±è´¥ä¸UIç«æ€

**é—®é¢˜ç°è±¡**ï¼šE2Eæµç¨‹å¶å‘å¤±è´¥ï¼Œæç¤ºå†…å®¹æœªå¦‚é¢„æœŸå‡ºç°ï¼Œæˆ–æµç¨‹å¡æ­»ã€‚

**æ’æŸ¥ä¸å»ºè®®**ï¼š
- æ£€æŸ¥æ–­è¨€æ˜¯å¦åŸºäºæç¤ºåŒºåŸŸå”¯ä¸€å†…å®¹ï¼ˆå¦‚ `.test-tip` æˆ– `#flow-tip`ï¼‰ï¼Œé¿å…ä¾èµ–UIåŠ¨ç”»ã€å¼‚æ­¥æ¸²æŸ“ç­‰ä¸ç¨³å®šèŠ‚ç‚¹ã€‚
- æ¨èä½¿ç”¨å¦‚ä¸‹æ–­è¨€æ–¹å¼ï¼ˆPlaywrightç¤ºä¾‹ï¼‰ï¼š
  ```ts
  await expect(page.locator('#flow-tip')).toHaveText('æ‹¼å›¾å®Œæˆï¼');
  ```
- è‹¥æµç¨‹æ¶‰åŠå¤šæ­¥è·³è½¬ï¼Œå»ºè®®æ¯æ­¥å‡ä»¥å”¯ä¸€æç¤ºå†…å®¹ä¸ºæ–­è¨€ï¼Œç¡®ä¿æµç¨‹å”¯ä¸€æ€§ã€‚

---

### 7.2 ç¯å¢ƒè¯†åˆ«ä¸æ•°æ®åˆ†ç»„å¼‚å¸¸

**é—®é¢˜ç°è±¡**ï¼šæµ‹è¯•æŠ¥å‘Šæœªæ­£ç¡®åˆ†ç»„ï¼Œæˆ–å¼€å‘/ç”Ÿäº§ç¯å¢ƒæ•°æ®æ··æ·†ã€‚

**æ’æŸ¥ä¸å»ºè®®**ï¼š
- æ£€æŸ¥ `EnvModeClient`ã€`layout.tsx`ã€`GameContext.tsx` ç­‰ç¯å¢ƒè¯†åˆ«é€»è¾‘ï¼Œç¡®ä¿ç¯å¢ƒå˜é‡è‡ªåŠ¨è¯†åˆ«ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½® `NODE_ENV`ã€‚
- ç¡®è®¤æµ‹è¯•å‘½ä»¤ä¸æ–‡æ¡£ä¸€è‡´ï¼š
  - å¼€å‘ç¯å¢ƒï¼š`npm run dev` + `npm run test:e2e`
  - ç”Ÿäº§ç¯å¢ƒï¼š`npm run build && npm start` + `npm run test:e2e`
- æ£€æŸ¥å½’æ¡£è„šæœ¬ `archive-test-results.js` æ˜¯å¦æ ¹æ®ç¯å¢ƒè‡ªåŠ¨å½’æ¡£ã€åˆ†ç»„ã€‚

---

### 7.3 testAPIå®‰å…¨æš´éœ²ä¸æƒé™é—®é¢˜

**é—®é¢˜ç°è±¡**ï¼šç”Ÿäº§ç¯å¢ƒä¸‹ testAPI ä»å¯è®¿é—®ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ã€‚

**æ’æŸ¥ä¸å»ºè®®**ï¼š
- æ£€æŸ¥ `app/api/performance-trend/route.ts` ç­‰APIå®ç°ï¼Œç¡®ä¿ä»…åœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒæš´éœ² testAPIã€‚
- Playwright æµ‹è¯•ä¸­å¦‚éœ€è°ƒç”¨ testAPIï¼ŒåŠ¡å¿…é€šè¿‡ `page.evaluate` å¹¶åŠ ç¯å¢ƒåˆ¤æ–­ã€‚
- ç”Ÿäº§ç¯å¢ƒä¸‹å»ºè®®å½»åº•å…³é—­ testAPI è·¯ç”±ã€‚

---

### 7.4 æ€§èƒ½æ•°æ®é‡‡é›†ä¸æŠ¥å‘Šå½’æ¡£å¤±è´¥

**é—®é¢˜ç°è±¡**ï¼šæ€§èƒ½æŒ‡æ ‡æœªé‡‡é›†ã€æŠ¥å‘Šæœªç”Ÿæˆæˆ–æ ¼å¼å¼‚å¸¸ã€‚

**æ’æŸ¥ä¸å»ºè®®**ï¼š
- æ£€æŸ¥ Playwright æµ‹è¯•è„šæœ¬ä¸­æ€§èƒ½é‡‡é›†é€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰å…³é”®èŠ‚ç‚¹å‡æœ‰æ€§èƒ½é‡‡é›†ä»£ç ã€‚
- æ£€æŸ¥ `archive-test-results.js` æ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼ŒæŠ¥å‘Šç›®å½•ä¸ç´¢å¼•æ˜¯å¦è‡ªåŠ¨æ›´æ–°ã€‚
- æŸ¥çœ‹ `playwright-test-logs/`ã€`test-results/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æœ€æ–°æŠ¥å‘Šå’Œç´¢å¼•ã€‚

---

### 7.5 ä¾èµ–ä¸ç¯å¢ƒä¸ä¸€è‡´

**é—®é¢˜ç°è±¡**ï¼šæœ¬åœ°ä¸CIã€ä¸åŒå¼€å‘è€…ç¯å¢ƒä¸‹æµ‹è¯•ç»“æœä¸ä¸€è‡´ã€‚

**æ’æŸ¥ä¸å»ºè®®**ï¼š
- æ£€æŸ¥ `package.json`ã€`package-lock.json` æ˜¯å¦é”å®šä¾èµ–ç‰ˆæœ¬ï¼Œé¿å…ä¾èµ–æ¼‚ç§»ã€‚
- æ¨èç»Ÿä¸€ä½¿ç”¨ `npm ci` å®‰è£…ä¾èµ–ï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´ã€‚
- å¦‚é‡Nodeç‰ˆæœ¬å·®å¼‚ï¼Œå»ºè®®é¡¹ç›®å†…é…ç½® `.nvmrc` å¹¶å›¢é˜Ÿç»Ÿä¸€ç‰ˆæœ¬ã€‚

---

### 7.6 ç›®å½•ç»“æ„ä¸.gitignoreé…ç½®é—®é¢˜

**é—®é¢˜ç°è±¡**ï¼šæµ‹è¯•æ•°æ®ã€ä¸´æ—¶æ–‡ä»¶è¯¯æäº¤ï¼Œæˆ–ä¸»æµç¨‹ä¸ä¸´æ—¶æµ‹è¯•æ··æ·†ã€‚

**æ’æŸ¥ä¸å»ºè®®**ï¼š
- æ£€æŸ¥ `.gitignore`ã€`.gitkeep` é…ç½®ï¼Œç¡®ä¿ä¸´æ—¶æ–‡ä»¶ã€æµ‹è¯•æŠ¥å‘Šã€æ—¥å¿—ç­‰ä¸è¢«æäº¤ã€‚
- ä¸»æµç¨‹æµ‹è¯•ä¸ä¸´æ—¶æµ‹è¯•å»ºè®®åˆ†ç›®å½•ç®¡ç†ï¼Œå¦‚ `e2e/`ã€`e2e/temp/`ï¼Œä¾¿äºåä½œä¸å½’æ¡£ã€‚

---

### 7.7 å‰ç«¯å¯è§†åŒ–ä¸APIèšåˆå¼‚å¸¸

**é—®é¢˜ç°è±¡**ï¼šå‰ç«¯ä»ªè¡¨ç›˜æ— æ³•æ­£ç¡®å±•ç¤ºåˆ†ç»„ã€è¶‹åŠ¿æˆ–æŠ¥å‘Šæ•°æ®ã€‚

**æ’æŸ¥ä¸å»ºè®®**ï¼š
- æ£€æŸ¥å‰ç«¯APIèšåˆé€»è¾‘ï¼Œç¡®ä¿å„ç¯å¢ƒã€åˆ†ç»„æ•°æ®æ­£ç¡®æ‹‰å–ä¸æ¸²æŸ“ã€‚
- æ£€æŸ¥APIæ¥å£æƒé™ä¸åªè¯»ç­–ç•¥ï¼Œé¿å…æ•°æ®è¢«è¯¯å†™æˆ–æ³„éœ²ã€‚
- å¦‚é‡æ•°æ®ç¼ºå¤±ï¼Œä¼˜å…ˆæ’æŸ¥åç«¯å½’æ¡£ä¸APIèšåˆæµç¨‹ã€‚

---

### 7.8 å…¶ä»–å¸¸è§é—®é¢˜

- **Playwrightåˆ†ç»„ä¸éš”ç¦»æœªç”Ÿæ•ˆ**ï¼šæ£€æŸ¥æµ‹è¯•è„šæœ¬åˆ†ç»„æ ‡ç­¾ä¸å‘½ä»¤å‚æ•°ã€‚
- **å›¢é˜Ÿåä½œå†²çª**ï¼šå»ºè®®å®šæœŸåŒæ­¥ä¸»æµç¨‹æµ‹è¯•è„šæœ¬ï¼Œä¸´æ—¶æµ‹è¯•åˆ†æ”¯ç‹¬ç«‹ç®¡ç†ã€‚
- **æŠ¥å‘Šæ ¼å¼ä¸ç»Ÿä¸€**ï¼šå½’æ¡£è„šæœ¬ä¸å‰ç«¯æ¸²æŸ“éœ€ç»Ÿä¸€æ ‡å‡†ï¼Œé¿å…æ‰‹å·¥ä¿®æ”¹ã€‚

---

### 7.9 é—®é¢˜æ’æŸ¥æµç¨‹å›¾

```mermaid
flowchart TD
  A["å‘ç°æµ‹è¯•å¼‚å¸¸"] --> B{"ç¯å¢ƒè¯†åˆ«æ­£ç¡®ï¼Ÿ"}
  B -- å¦ --> B1["æ£€æŸ¥EnvModeClientä¸å‘½ä»¤"]
  B -- æ˜¯ --> C{"æ–­è¨€ä¸æ•°æ®åˆ†ç»„æ­£ç¡®ï¼Ÿ"}
  C -- å¦ --> C1["æ£€æŸ¥æ–­è¨€å”¯ä¸€æ€§ä¸åˆ†ç»„é€»è¾‘"]
  C -- æ˜¯ --> D{"APIä¸æŠ¥å‘Šå½’æ¡£æ­£å¸¸ï¼Ÿ"}
  D -- å¦ --> D1["æ£€æŸ¥APIæƒé™ä¸å½’æ¡£è„šæœ¬"]
  D -- æ˜¯ --> E["æ£€æŸ¥ä¾èµ–ä¸ç›®å½•ç»“æ„"]
  E --> F["é—®é¢˜å®šä½ä¸ä¿®å¤"]
```

---

### 7.10 æµ‹è¯•è„šæœ¬å˜æ›´åå‰ç«¯æŠ¥å‘Šæ— å˜åŒ–æ˜¯å¦éœ€é‡å¯æœåŠ¡ï¼Ÿ

**é—®é¢˜ç°è±¡**ï¼š
ä¿®æ”¹äº†æµ‹è¯•è„šæœ¬ï¼ˆå¦‚ e2e/full_game_flow.spec.tsï¼‰æˆ–ç›¸å…³æµ‹è¯•é€»è¾‘åï¼Œåœ¨æ²¡æœ‰é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹ç›´æ¥è¿è¡Œæµ‹è¯•ï¼Œå‘ç°å‰ç«¯å¯è§†åŒ–æŠ¥å‘Šï¼ˆå¦‚ app/test/page.tsx ä»ªè¡¨ç›˜ï¼‰æ²¡æœ‰åæ˜ æœ€æ–°æµ‹è¯•ç»“æœæˆ–æŠ¥å‘Šå†…å®¹ã€‚

**åŸå› åˆ†æ**ï¼š
1. å‰ç«¯ä»ªè¡¨ç›˜é€šè¿‡ APIï¼ˆå¦‚ /api/performance-trendï¼‰åŠ¨æ€æ‹‰å–æœ¬åœ°å½’æ¡£çš„ Markdown æŠ¥å‘Šï¼ˆplaywright-test-logs/*.mdï¼‰ï¼Œè¿™äº›æŠ¥å‘Šç”±æµ‹è¯•è„šæœ¬æ‰§è¡Œ+å½’æ¡£è„šæœ¬è‡ªåŠ¨ç”Ÿæˆã€‚
2. å¦‚æœåªä¿®æ”¹äº†æµ‹è¯•è„šæœ¬ï¼ˆe2e/ç›®å½•ä¸‹ï¼‰ï¼Œé€šå¸¸ä¸å½±å“ Next.js æœåŠ¡ç«¯æˆ–APIå±‚ï¼Œæ— éœ€é‡å¯æœåŠ¡ï¼Œåªè¦é‡æ–°è¿è¡Œæµ‹è¯•ï¼Œå½’æ¡£è„šæœ¬ä¼šç”Ÿæˆæ–°æŠ¥å‘Šï¼Œå‰ç«¯ä»ªè¡¨ç›˜æ‹‰å–åˆ°çš„å°±æ˜¯æœ€æ–°æ•°æ®ã€‚
3. å¦‚æœä¿®æ”¹äº† API èšåˆé€»è¾‘ï¼ˆå¦‚ app/api/performance-trend/route.tsï¼‰ã€å‰ç«¯é¡µé¢ï¼ˆapp/test/page.tsxï¼‰ã€å½’æ¡£è„šæœ¬ï¼ˆscripts/archive-test-results.jsï¼‰ç­‰ï¼ŒNext.js å¯èƒ½éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–å…³é—­äº†çƒ­æ›´æ–°çš„æƒ…å†µä¸‹ã€‚
4. æŸäº›æƒ…å†µä¸‹ï¼Œå¼€å‘ç¯å¢ƒä¸‹ Next.js çƒ­æ›´æ–°å¤±æ•ˆæˆ–ç¼“å­˜æœªåˆ·æ–°ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å‰ç«¯é¡µé¢/æ¥å£æœªèƒ½åŠæ—¶åæ˜ æœ€æ–°æ•°æ®ã€‚

**å·¥ç¨‹å»ºè®®**ï¼š
- åªæ”¹æµ‹è¯•è„šæœ¬ï¼ˆe2e/ï¼‰ï¼šåªéœ€é‡æ–°è¿è¡Œæµ‹è¯•ï¼ˆnpm run test:e2eï¼‰ï¼Œæ— éœ€é‡å¯æœåŠ¡ï¼Œå‰ç«¯ä»ªè¡¨ç›˜åˆ·æ–°å³å¯çœ‹åˆ°æœ€æ–°æŠ¥å‘Šã€‚
- æ”¹åŠ¨APIèšåˆã€å‰ç«¯é¡µé¢ã€å½’æ¡£è„šæœ¬ç­‰æ ¸å¿ƒé€»è¾‘ï¼šå»ºè®®é‡å¯Next.jsæœåŠ¡ï¼ˆå¦‚ ctrl+c åé‡æ–° npm run dev æˆ– npm run build && npm startï¼‰ï¼Œç¡®ä¿APIå’Œå‰ç«¯é¡µé¢åŠ è½½åˆ°æœ€æ–°ä»£ç ã€‚
- å¼€å‘ç¯å¢ƒä¸‹ä»ªè¡¨ç›˜æ— å˜åŒ–ï¼šå…ˆç¡®è®¤æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆï¼ˆplaywright-test-logs/æœ‰æ–°mdæ–‡ä»¶ï¼‰ï¼Œå†åˆ·æ–°å‰ç«¯é¡µé¢ã€‚å¦‚æœä¾ç„¶æ— å˜åŒ–ï¼Œå°è¯•é‡å¯æœåŠ¡ã€‚
- ç”Ÿäº§ç¯å¢ƒæˆ–CI/CDï¼šæ‰€æœ‰å˜æ›´å»ºè®®é‡å¯æœåŠ¡ï¼Œç¡®ä¿æ— ç¼“å­˜å’Œä»£ç æœªç”Ÿæ•ˆé—®é¢˜ã€‚

**æ€»ç»“**ï¼š
- åªæ”¹æµ‹è¯•è„šæœ¬ â†’ ä¸å¿…é‡å¯æœåŠ¡ï¼Œåªéœ€é‡æ–°è·‘æµ‹è¯•+åˆ·æ–°å‰ç«¯é¡µé¢ã€‚
- æ”¹åŠ¨API/å‰ç«¯/å½’æ¡£è„šæœ¬ â†’ å»ºè®®é‡å¯æœåŠ¡ï¼Œç¡®ä¿æ‰€æœ‰é€»è¾‘å’Œæ•°æ®æµä¸ºæœ€æ–°ã€‚

---

### 7.11 å…¸å‹é—®é¢˜ä¸æ’æŸ¥è¡¥å……

> **é¡µé¢/è·¯ç”± 404 é¢‘å‘**ï¼šä¼˜å…ˆæ£€æŸ¥ app ç›®å½•ç»“æ„ã€layout/page.tsx å‘½åä¸ä½ç½®ï¼Œç¡®ä¿ç¬¦åˆ Next.js 13+ è§„èŒƒã€‚
> 
> **å‰ç«¯ fetch 404**ï¼šç¡®è®¤ API è·¯ç”±æˆ–é™æ€èµ„æºè·¯å¾„æ˜¯å¦äº’é€šï¼Œæ¨èä¼˜å…ˆç”¨ API èšåˆã€‚
> 
> **ä¾èµ–ç¼ºå¤±æŠ¥é”™**ï¼šå¦‚ fs-extraï¼Œè¯·æŸ¥é˜…ä¾èµ–å£°æ˜è¡¥å……å¹¶å®‰è£…ï¼Œè¡¥å……å®‰è£…ã€‚
> 
> **æŠ¥å‘Šæ— æ•°æ®**ï¼šæ£€æŸ¥ Playwright attach ç»™å‡ºçš„éå†æ–¹å¼ä¸å½’æ¡£è„šæœ¬æ–¹å¼æ˜¯å¦ä¸€è‡´ã€‚

---

## 8. æ–°é¡¹ç›®è½åœ°æŒ‡å¼•

### 8.1 è¿ç§»æ­¥éª¤ä¸æ³¨æ„äº‹é¡¹

1. **åˆå§‹åŒ–é¡¹ç›®ç»“æ„**
   - å‚è€ƒæœ¬é¡¹ç›®ç›®å½•ç»“æ„ï¼Œåˆ›å»º `e2e/`ã€`e2e/temp/`ã€`scripts/`ã€`app/api/`ã€`app/test/`ã€`playwright-test-logs/` ç­‰æ ¸å¿ƒç›®å½•ã€‚
   - é…ç½® `.gitignore`ã€`.gitkeep`ï¼Œç¡®ä¿æµ‹è¯•æŠ¥å‘Šã€ä¸´æ—¶æ–‡ä»¶ä¸è¢«æäº¤ã€‚

### 8.1.1 ä¸€é”®æ„å»º-åˆå§‹åŒ–æµç¨‹

> **å·¥ç¨‹è¦ç‚¹ï¼šè¿ç§»æˆ–æ–°é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œå»ºè®®é‡‡ç”¨ä¸€é”®å¼ç›®å½•ã€æ–‡ä»¶ã€ä¾èµ–ã€éªŒè¯å…¨æµç¨‹ï¼Œæå¤§æå‡è½åœ°æ•ˆç‡å’Œä¸€è‡´æ€§ã€‚**

1. **åˆå§‹åŒ–ç›®å½•ç»“æ„**
   ```bash
   mkdir -p app/test/dashboard app/api/performance-trend e2e scripts playwright-test-logs playwright-report test-results
   touch playwright-test-logs/.gitkeep playwright-report/.gitkeep test-results/.gitkeep
   ```

2. **å¤åˆ¶æ¨¡æ¿æ–‡ä»¶**
   ```bash
   cp <æ¨¡æ¿ä»“åº“>/app/layout.tsx app/
   cp <æ¨¡æ¿ä»“åº“>/app/page.tsx app/
   cp <æ¨¡æ¿ä»“åº“>/app/test/dashboard/page.tsx app/test/dashboard/
   cp <æ¨¡æ¿ä»“åº“>/app/api/performance-trend/route.ts app/api/performance-trend/
   cp <æ¨¡æ¿ä»“åº“>/e2e/full_game_flow.spec.ts e2e/
   cp <æ¨¡æ¿ä»“åº“>/scripts/archive-test-results.js scripts/
   cp <æ¨¡æ¿ä»“åº“>/.gitignore .
   cp <æ¨¡æ¿ä»“åº“>/next.config.mjs .
   cp <æ¨¡æ¿ä»“åº“>/package.json .
   ```

3. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

4. **è¿è¡Œä¸éªŒè¯**
   ```bash
   npm run dev
   npm run test:e2e
   ```

> **å»ºè®®**ï¼šå¦‚æœ‰å›¢é˜Ÿæ¨¡æ¿ä»“åº“ï¼Œå»ºè®®å°†ä¸Šè¿°æµç¨‹è„šæœ¬åŒ–ï¼Œæ”¯æŒä¸€é”®åˆå§‹åŒ–å’Œæ‰¹é‡è¿ç§»ï¼Œæå‡åä½œæ•ˆç‡ã€‚

### 8.1.2 ä¸€é”®æ‹‰èµ·å…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¸å¯è§†åŒ–æµç¨‹ bootstrap è„šæœ¬

> **æ¨èåœ¨ package.json ä¸­æ·»åŠ å¦‚ä¸‹ scriptsï¼Œå®ç°ä¸€æ¡å‘½ä»¤å®Œæˆä¾èµ–å®‰è£…ã€E2E æµ‹è¯•ã€æŠ¥å‘Šå½’æ¡£ä¸å‰ç«¯å¯è§†åŒ–ã€‚**

```json
"scripts": {
  "bootstrap": "npm install && npm run test:e2e && node scripts/archive-test-results.js && npm run dev"
}
```

- `npm run bootstrap`ï¼šä¸€é”®å®Œæˆä¾èµ–å®‰è£…ã€E2E æµ‹è¯•ã€æŠ¥å‘Šå½’æ¡£ã€å‰ç«¯æœåŠ¡æ‹‰èµ·ã€‚
- å¯æ ¹æ®å®é™…æµç¨‹æ‹†åˆ†ä¸º `init`ã€`test:e2e`ã€`archive`ã€`dev` ç­‰å­å‘½ä»¤ã€‚
- æ”¯æŒæ–°æˆå‘˜æˆ– CI/CD ç¯å¢ƒä¸€é”®éªŒè¯å…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯ã€‚

> **ç”¨æ³•ç¤ºä¾‹ï¼š**
>
> ```bash
> npm run bootstrap
> ```
>
> - è‡ªåŠ¨å®‰è£…ä¾èµ–
> - è¿è¡Œ E2E æµ‹è¯•
> - å½’æ¡£æµ‹è¯•æŠ¥å‘Š
> - å¯åŠ¨å‰ç«¯ä»ªè¡¨ç›˜

---

### 8.2 ç›®å½•/å­—æ®µ/æµç¨‹/æŠ¥å‘Šä¸€è‡´æ€§è¿ç§»æ¸…å•

- **ç›®å½•ç»“æ„**ï¼š
  - `e2e/` ä¸»æµç¨‹ä¸ä¸´æ—¶æµ‹è¯•åˆ†ç¦»
  - `scripts/` å½’æ¡£è„šæœ¬ç‹¬ç«‹
  - `app/api/`ã€`app/test/` å‰åç«¯åˆ†æ˜
  - `playwright-test-logs/`ã€`playwright-report/`ã€`test-results/` å½’æ¡£ç›®å½•è§„èŒƒ
- **å­—æ®µä¸æ•°æ®ç»“æ„**ï¼š
  - APIã€æŠ¥å‘Šã€å‰ç«¯ä»ªè¡¨ç›˜å­—æ®µä¿æŒä¸€è‡´ï¼ˆå¦‚ envã€metricsã€dateã€result ç­‰ï¼‰
  - åˆ†ç»„å­—æ®µï¼ˆå¦‚ "development"ã€"production"ï¼‰å…¨é“¾è·¯ä¸€è‡´
- **æµç¨‹è§„èŒƒ**ï¼š
  - æµ‹è¯•æµç¨‹å”¯ä¸€æ–­è¨€ï¼Œæµç¨‹èŠ‚ç‚¹ä¸æç¤ºå†…å®¹ä¸€ä¸€å¯¹åº”
  - æ€§èƒ½é‡‡é›†ã€æŠ¥å‘Šå½’æ¡£ã€APIèšåˆã€å‰ç«¯å¯è§†åŒ–å…¨é“¾è·¯æ‰“é€š
- **æŠ¥å‘Šæ ‡å‡†**ï¼š
  - MarkdownæŠ¥å‘Šã€ç´¢å¼•è¡¨ã€è¶‹åŠ¿åˆ†æè¡¨ç»“æ„ç»Ÿä¸€ï¼Œä¾¿äºè‡ªåŠ¨èšåˆä¸æŸ¥é˜…

---

### 8.3 æ¨¡æ¿ä¸è„šæœ¬å¤ç”¨å»ºè®®

- æ¨èå°†ä¸»æµç¨‹ E2E è„šæœ¬ã€å½’æ¡£è„šæœ¬ã€APIèšåˆã€å‰ç«¯ä»ªè¡¨ç›˜ç­‰ä½œä¸ºæ¨¡æ¿ï¼ŒæŒ‰éœ€è°ƒæ•´ä¸šåŠ¡æµç¨‹ä¸å­—æ®µã€‚
- å¯å°†å¸¸ç”¨æ–­è¨€ã€æ€§èƒ½é‡‡é›†ã€åˆ†ç»„é€»è¾‘å°è£…ä¸ºå·¥å…·å‡½æ•°ï¼Œä¾¿äºå¤šé¡¹ç›®å¤ç”¨ã€‚
- å»ºè®®å›¢é˜Ÿæ²‰æ·€ä¸€å¥—"è‡ªåŠ¨åŒ–æµ‹è¯•å·¥ç¨‹æ¨¡æ¿ä»“åº“"ï¼Œæ–°é¡¹ç›®å¯ä¸€é”®åˆå§‹åŒ–ã€‚
- è¿ç§»æ—¶ä¼˜å…ˆä¿è¯å­—æ®µã€æµç¨‹ã€æŠ¥å‘Šç»“æ„ä¸€è‡´ï¼Œåç»­å¯æ ¹æ®ä¸šåŠ¡æ‰©å±•ã€‚

---

### 8.4 è¿ç§»æ¡ˆä¾‹ä¸è„šæœ¬æ¨¡æ¿

#### 8.4.1 å…¸å‹è¿ç§»æ¡ˆä¾‹ï¼šPuzzleX æ–°é¡¹ç›®è½åœ°æµç¨‹

1. **åˆå§‹åŒ–ç›®å½•ç»“æ„**
   ```bash
   mkdir -p e2e/temp scripts app/api/performance-trend app/test playwright-test-logs playwright-report test-results
   touch playwright-test-logs/.gitkeep playwright-report/.gitkeep test-results/.gitkeep
   cp -r <æ¨¡æ¿ä»“åº“>/e2e/full_game_flow.spec.ts e2e/
   cp <æ¨¡æ¿ä»“åº“>/scripts/archive-test-results.js scripts/
   cp <æ¨¡æ¿ä»“åº“>/app/api/performance-trend/route.ts app/api/performance-trend/
   cp <æ¨¡æ¿ä»“åº“>/app/test/page.tsx app/test/
   cp <æ¨¡æ¿ä»“åº“>/app/layout.tsx app/
   cp <æ¨¡æ¿ä»“åº“>/.gitignore .
   ```
2. **é€‚é…ä¸šåŠ¡æµç¨‹**
   - ä¿®æ”¹ `full_game_flow.spec.ts` æ–­è¨€ä¸æµç¨‹èŠ‚ç‚¹ï¼Œç¡®ä¿ä¸æ–°é¡¹ç›®UIæç¤ºå†…å®¹ä¸€è‡´ã€‚
   - å¦‚æœ‰ç‰¹æ®Šæ€§èƒ½æŒ‡æ ‡ï¼Œæ‰©å±• `archive-test-results.js`ã€‚
   - å‰ç«¯ä»ªè¡¨ç›˜ `page.tsx` æŒ‰éœ€è°ƒæ•´å­—æ®µä¸å¯è§†åŒ–é€»è¾‘ã€‚
3. **æœ¬åœ°éªŒè¯**
   - `npm run dev` å¯åŠ¨å¼€å‘ç¯å¢ƒï¼Œ`npm run test:e2e` è·‘é€šå…¨é“¾è·¯ã€‚
   - æ£€æŸ¥ `playwright-test-logs/` ä¸‹æŠ¥å‘Šï¼Œå‰ç«¯ä»ªè¡¨ç›˜åˆ†ç»„ã€è¶‹åŠ¿ã€å¯¹æ¯”ç­‰åŠŸèƒ½ã€‚

---

#### 8.4.2 ä¸»æµç¨‹ E2E è„šæœ¬æ¨¡æ¿ï¼ˆe2e/full_game_flow.spec.tsï¼‰
```ts
import { test, expect } from '@playwright/test';

test('å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹', async ({ page }) => {
  await page.goto('http://localhost:3000');
  await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©ä¸€ä¸ªå½¢çŠ¶');
  // å¯é€‰ï¼šå¼€å‘ç¯å¢ƒä¸‹ç”¨ testAPI è·³è½¬
  if (await page.evaluate(() => window.testAPI)) {
    await page.evaluate(() => window.testAPI.selectPieceForTest(1));
  } else {
    await page.click('[data-piece-id="1"]');
  }
  await expect(page.locator('#flow-tip')).toHaveText('è¯·é€‰æ‹©åˆ‡å‰²ç±»å‹');
  // ...åç»­æµç¨‹
  await expect(page.locator('#flow-tip')).toHaveText('æ‹¼å›¾å®Œæˆï¼');
  // æ€§èƒ½é‡‡é›†
  const pageLoad = await page.evaluate(() => window.performance.timing.domContentLoadedEventEnd - window.performance.timing.navigationStart);
  await test.info().attach('performance-metrics', { body: Buffer.from(JSON.stringify({ pageLoad }), 'utf-8'), contentType: 'application/json' });
});
```

---

#### 8.4.3 å½’æ¡£è„šæœ¬æ¨¡æ¿ï¼ˆscripts/archive-test-results.jsï¼‰
```js
const fs = require('fs');
const path = require('path');
const results = JSON.parse(fs.readFileSync('test-results/test-results.json', 'utf-8'));
const reportDir = 'playwright-test-logs';
const dateStr = new Date().toISOString().replace(/[-:T]/g, '').slice(0, 12);
const reportFile = path.join(reportDir, `test-report-${dateStr}.md`);
const metrics = results.attachments?.find(a => a.name === 'performance-metrics');
const metricsData = metrics ? JSON.parse(Buffer.from(metrics.body, 'base64').toString('utf-8')) : {};
const content = `<!-- { "env": "development", "metrics": ${JSON.stringify(metricsData)} } -->\n# è‡ªåŠ¨åŒ–æµç¨‹æµ‹è¯•æŠ¥å‘Š\n- **æµ‹è¯•æ—¶é—´**: ${new Date().toLocaleString()}\n- **æ€§èƒ½æ•°æ®**: ${JSON.stringify(metricsData)}\n`;
fs.writeFileSync(reportFile, content);
```

---

#### 8.4.4 API èšåˆæ¨¡æ¿ï¼ˆapp/api/performance-trend/route.tsï¼‰
```ts
import fs from 'fs';
import path from 'path';
export async function GET() {
  const logDir = path.join(process.cwd(), 'playwright-test-logs');
  const files = fs.readdirSync(logDir).filter(f => f.endsWith('.md'));
  const trendData = files.map(file => {
    const content = fs.readFileSync(path.join(logDir, file), 'utf-8');
    const match = content.match(/<!--\s*(\{[\s\S]*?\})\s*-->/);
    if (match && match[1]) {
      return JSON.parse(match[1]);
    }
    return null;
  }).filter(Boolean);
  return new Response(JSON.stringify(trendData.reverse()));
}
```

---

#### 8.4.5 å‰ç«¯ä»ªè¡¨ç›˜æ¨¡æ¿ç‰‡æ®µï¼ˆapp/test/page.tsxï¼‰
```tsx
import { useEffect, useState } from 'react';
export default function TestDashboard() {
  const [trendData, setTrendData] = useState([]);
  useEffect(() => {
    fetch('/api/performance-trend').then(res => res.json()).then(setTrendData);
  }, []);
  return (
    <div>
      <h2>è‡ªåŠ¨åŒ–æµ‹è¯•è¶‹åŠ¿</h2>
      <pre>{JSON.stringify(trendData, null, 2)}</pre>
      {/* å¯æ‰©å±•ä¸ºè¡¨æ ¼ã€è¶‹åŠ¿å›¾ç­‰å¯è§†åŒ–ç»„ä»¶ */}
    </div>
  );
}
```

---

#### 8.4.6 å½’æ¡£è„šæœ¬ä¸ API èšåˆå¥å£®æ¨¡æ¿

#### å½’æ¡£è„šæœ¬ï¼ˆscripts/archive-test-results.jsï¼‰
ï¼ˆå·²åŒ…å«å¥å£®éå†ä¸ç´¢å¼•ï¼Œæ³¨æ„ fs-extra ä¾èµ–ï¼‰
```js
const fs = require('fs-extra');
const path = require('path');
const results = JSON.parse(fs.readFileSync('test-results/test-results.json', 'utf-8'));
let metricsData = {};
for (const result of results.attachments || []) {
  for (const attachment of result.attachments || []) {
    if (attachment.name === 'performance-metrics') {
      metricsData = JSON.parse(Buffer.from(attachment.body, 'base64').toString('utf-8'));
    }
  }
}
const reportDir = 'playwright-test-logs';
fs.ensureDirSync(reportDir);
const dateStr = new Date().toISOString().replace(/[-T]/g, '').slice(0, 12);
const reportFile = path.join(reportDir, `test-report-${dateStr}.md`);
const content = `<!-- {"env": "development", "metrics": ${JSON.stringify(metricsData)} } -->\n` +
  `# è‡ªåŠ¨åŒ–æµç¨‹æµ‹è¯•æŠ¥å‘Š\n- **æµ‹è¯•æ—¶é—´**: ${new Date().toLocaleString()}\n- **æ€§èƒ½æ•°æ®**: ${JSON.stringify(metricsData)}\n`;
fs.writeFileSync(reportFile, content);
// è‡ªåŠ¨ç”Ÿæˆç´¢å¼•
const files = fs.readdirSync(reportDir).filter(f => f.endsWith('.md'));
const indexContent = files.map(f => `- [${f}](./${f})`).join('\n');
fs.writeFileSync(path.join(reportDir, 'index.md'), indexContent);
```

#### API èšåˆï¼ˆapp/api/performance-trend/route.tsï¼‰
```ts
import fs from 'fs';
import path from 'path';
export async function GET() {
  const logDir = path.join(process.cwd(), 'playwright-test-logs');
  const files = fs.readdirSync(logDir).filter(f => f.endsWith('.md'));
  const trendData = files.map(file => {
    const content = fs.readFileSync(path.join(logDir, file), 'utf-8');
    const match = content.match(/<!--\s*(\{[\s\S]*?\})\s*-->/);
    if (match && match[1]) {
      return JSON.parse(match[1]);
    }
    return null;
  }).filter(Boolean);
  return new Response(JSON.stringify(trendData.reverse()));
}
```

---

> ä»¥ä¸Šæ¡ˆä¾‹ä¸æ¨¡æ¿å¯ç›´æ¥å¤ç”¨äºæ–°é¡¹ç›®ï¼ŒæŒ‰éœ€è°ƒæ•´ä¸šåŠ¡æµç¨‹ã€å­—æ®µä¸å¯è§†åŒ–é€»è¾‘ï¼Œå³å¯å®ç°å…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯çš„å·¥ç¨‹è½åœ°ã€‚

---

## 9. è¿›é˜¶å»ºè®®ä¸å›¢é˜Ÿåä½œ

### 9.1 æŒç»­ä¼˜åŒ–æŒ‡æ ‡é‡‡é›†ä¸è¶‹åŠ¿åˆ†æ
- å®šæœŸè¯„ä¼°å’Œæ‰©å±•æ€§èƒ½é‡‡é›†æŒ‡æ ‡ï¼ˆå¦‚èµ„æºåŠ è½½ã€ç«¯åˆ°ç«¯åŠ è½½ã€FPSã€å†…å­˜ã€äº¤äº’å»¶è¿Ÿç­‰ï¼‰ï¼Œç»“åˆä¸šåŠ¡éœ€æ±‚åŠ¨æ€è°ƒæ•´ã€‚
- åˆ©ç”¨å½’æ¡£æŠ¥å‘Šä¸å‰ç«¯ä»ªè¡¨ç›˜ï¼Œå®šæœŸå›é¡¾æ€§èƒ½è¶‹åŠ¿ï¼Œå‘ç°å›å½’ä¸ç“¶é¢ˆï¼Œæ¨åŠ¨æ€§èƒ½ä¼˜åŒ–ã€‚
- æ”¯æŒå¤šç¯å¢ƒã€å¤šåˆ†ç»„å¯¹æ¯”ï¼Œä¾¿äºå®šä½ç¯å¢ƒç‰¹æœ‰é—®é¢˜ã€‚

### 9.2 å›¢é˜Ÿåä½œä¸ CI/CD é›†æˆ
- æ¨èåœ¨ CI/CD æµç¨‹ä¸­é›†æˆ `npm run test:e2e`ï¼Œæ¯æ¬¡æäº¤/PR è‡ªåŠ¨è¿è¡Œä¸»æµç¨‹æµ‹è¯•ä¸å½’æ¡£ï¼Œä¿éšœä¸»æµç¨‹ç¨³å®šã€‚
- ä¸´æ—¶/ä¸“é¡¹æµ‹è¯•å»ºè®®åœ¨åˆ†æ”¯æˆ–æœ¬åœ°è¿è¡Œï¼Œé¿å…æ±¡æŸ“ä¸»æµç¨‹å½’æ¡£ä¸æŠ¥å‘Šã€‚
- å½’æ¡£æŠ¥å‘Šä¸å‰ç«¯ä»ªè¡¨ç›˜ä¸ºå›¢é˜Ÿæä¾›ç»Ÿä¸€çš„æ€§èƒ½ä¸æµç¨‹å¯è§†åŒ–ï¼Œä¾¿äºåä½œä¸æ²Ÿé€šã€‚
- å»ºè®®å®šæœŸç»„ç»‡å›¢é˜Ÿå›é¡¾æµ‹è¯•æŠ¥å‘Šä¸æ€§èƒ½è¶‹åŠ¿ï¼Œæ¨åŠ¨åä½œä¸æŒç»­æ”¹è¿›ã€‚

### 9.3 Playwright è„šæœ¬ä¸ä¾èµ–ç»´æŠ¤
- å®šæœŸå‡çº§ Playwright åŠç›¸å…³ä¾èµ–ï¼Œå…³æ³¨å®˜æ–¹å‘å¸ƒæ—¥å¿—ï¼ŒåŠæ—¶é€‚é…APIå˜æ›´ã€‚
- å‡çº§åå»ºè®®å…¨é“¾è·¯å›å½’æµ‹è¯•ï¼Œç¡®ä¿è„šæœ¬ä¸å½’æ¡£æµç¨‹ç¨³å®šã€‚
- æ¨èåœ¨ CI/æœ¬åœ°åŠ å…¥ lint/type checkï¼ˆå¦‚ tsc --noEmitã€ESLintï¼‰ï¼Œæå‡è„šæœ¬è´¨é‡ã€‚
- å»ºè®®å°† playwright.config.tsã€å½’æ¡£è„šæœ¬ã€æµ‹è¯•æŒ‡ä»¤çº³å…¥æ¨¡æ¿ä»“åº“ï¼Œå›¢é˜Ÿç»Ÿä¸€ç»´æŠ¤ã€‚

### 9.4 ç»éªŒæ²‰æ·€ä¸æ–‡æ¡£åŒæ­¥æœºåˆ¶
- å˜æ›´æµ‹è¯•æµç¨‹ã€å½’æ¡£è„šæœ¬ã€æŠ¥å‘Šç»“æ„ã€å‰ç«¯ä»ªè¡¨ç›˜ç­‰ï¼Œéœ€åŒæ­¥ä¿®è®¢æŠ€æœ¯æ–‡æ¡£ä¸åä½œè¯´æ˜ï¼Œç¡®ä¿å›¢é˜Ÿæˆå‘˜ç†è§£ä¸€è‡´ã€‚
- å»ºè®®å»ºç«‹"è‡ªåŠ¨åŒ–æµ‹è¯•å·¥ç¨‹æ¨¡æ¿ä»“åº“"ï¼Œæ²‰æ·€æœ€ä½³å®è·µä¸è„šæœ¬æ¨¡æ¿ï¼Œä¾¿äºæ–°é¡¹ç›®å¿«é€Ÿè½åœ°ã€‚
- å®šæœŸå¤ç›˜æµ‹è¯•æµç¨‹ä¸æ–‡æ¡£ï¼Œæ”¶é›†å›¢é˜Ÿåé¦ˆï¼ŒæŒç»­ä¼˜åŒ–å·¥ç¨‹æ–¹æ¡ˆã€‚

### 9.5 å…¸å‹ GitHub Actions CI/CD é…ç½®ç‰‡æ®µï¼ˆplaywright.ymlï¼‰

> ä»¥ä¸‹ä¸º Playwright å…¨é“¾è·¯è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯å·¥ç¨‹çš„å…¸å‹ GitHub Actions CI/CD é…ç½®ç‰‡æ®µï¼Œå¯ç›´æ¥å¤ç”¨ï¼š

```yaml
name: Playwright E2E Tests

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18.x'

      - name: Install dependencies
        run: npm ci

      - name: Install Playwright Browsers (Chromium only, æ¨èèŠ‚çœCIèµ„æº)
        run: npx playwright install chromium --with-deps

      - name: Run Playwright E2E tests
        run: npm run test:e2e

      - name: å½’æ¡£æµ‹è¯•æŠ¥å‘Šï¼ˆå¯é€‰ï¼Œéœ€æœ‰å½’æ¡£è„šæœ¬ï¼‰
        run: node scripts/archive-test-results.js

      - name: Upload Playwright HTML report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30

      - name: Upload å½’æ¡£ Markdown æŠ¥å‘Š
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-test-logs
          path: playwright-test-logs/
          retention-days: 30
```

- æ”¯æŒè‡ªåŠ¨ä¾èµ–å®‰è£…ã€æµè§ˆå™¨ç¯å¢ƒæ‹‰èµ·ã€E2E æµ‹è¯•ã€æŠ¥å‘Šå½’æ¡£ä¸ä¸Šä¼ ï¼Œé€‚é…ä¸»æµ Playwright å·¥ç¨‹å®è·µã€‚
- å¯æ ¹æ®å®é™…éœ€è¦æ‰©å±•å¤š Node ç‰ˆæœ¬ã€å¤šæ“ä½œç³»ç»Ÿã€å¤šæµè§ˆå™¨çŸ©é˜µã€‚
- å¦‚éœ€è‡ªåŠ¨å‘å¸ƒæŠ¥å‘Šåˆ°é™æ€ç«™ç‚¹ï¼Œå¯ç»“åˆ GitHub Pages æˆ– OSS/CDNã€‚

---

> æœ¬ç« ä¸ºå›¢é˜Ÿåä½œä¸å·¥ç¨‹è½åœ°çš„è¿›é˜¶å»ºè®®ï¼Œç»“åˆè‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯çš„å…¨é“¾è·¯å®è·µï¼ŒåŠ©åŠ›å›¢é˜ŸæŒç»­æå‡æµ‹è¯•è´¨é‡ã€æ€§èƒ½å¯è§†åŒ–ä¸åä½œæ•ˆç‡ã€‚

---

> æœ¬æ–‡æ¡£ä¸ºå…¨æ ˆå·¥ç¨‹å¸ˆè§†è§’ä¸‹çš„ Playwright è‡ªåŠ¨åŒ–æµ‹è¯•é—­ç¯å·¥ç¨‹å®è·µæ€»ç»“ï¼Œé€‚ç”¨äºç°ä»£ Web é¡¹ç›®å›¢é˜Ÿçš„å·¥ç¨‹è½åœ°ã€è¿ç§»ä¸æŒç»­ä¼˜åŒ–ã€‚